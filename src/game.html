<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MJKSZ4KN');</script>
  <!-- End Google Tag Manager -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞ ‚Äî –ü–æ—à—É–∫ —Ä–æ–±–æ—Ç–∏ –≤ –ü–æ–ª—å—â—ñ | Rybezh Game</title>
  <meta name="description" content="–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ 2D –±—Ä–∞—É–∑–µ—Ä–Ω–∞ –≥—Ä–∞: –∑—ñ–≥—Ä–∞–π—Ç–µ –∑–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –≤–µ—Ç–µ—Ä–∞–Ω–∞, —è–∫–∏–π —à—É–∫–∞—î —Ä–æ–±–æ—Ç—É —É –ü–æ–ª—å—â—ñ. –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π –≥–µ–π–º–ø–ª–µ–π –∑ –¥—ñ–∞–ª–æ–≥–∞–º–∏, –∫–≤–µ—Å—Ç–∞–º–∏ —Ç–∞ –º–æ—Ä–∞–ª—å–Ω–∏–º–∏ –≤–∏–±–æ—Ä–∞–º–∏.">
  <link rel="canonical" href="https://rybezh.site/game.html">
  <link rel="alternate" hreflang="uk" href="https://rybezh.site/game.html">
  <link rel="alternate" hreflang="x-default" href="https://rybezh.site/game.html">
  <meta name="robots" content="index, follow">
  <meta name="author" content="Rybezh">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://rybezh.site/game.html">
  <meta property="og:title" content="–®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞ ‚Äî –ü–æ—à—É–∫ —Ä–æ–±–æ—Ç–∏ –≤ –ü–æ–ª—å—â—ñ | Rybezh Game">
  <meta property="og:description" content="–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ 2D –±—Ä–∞—É–∑–µ—Ä–Ω–∞ –≥—Ä–∞ –ø—Ä–æ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ–≥–æ –≤–µ—Ç–µ—Ä–∞–Ω–∞, —è–∫–∏–π —à—É–∫–∞—î —Ä–æ–±–æ—Ç—É —É –ü–æ–ª—å—â—ñ.">
  <meta property="og:image" content="https://rybezh.site/og-image.png">
  <meta property="og:locale" content="uk_UA">
  <meta property="og:site_name" content="Rybezh">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="–®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞ ‚Äî 2D Gra | Rybezh">
  <meta name="twitter:description" content="–ó—ñ–≥—Ä–∞–π—Ç–µ –∑–∞ –≤–µ—Ç–µ—Ä–∞–Ω–∞ —É –ø–æ—à—É–∫–∞—Ö —Ä–æ–±–æ—Ç–∏ —É –ü–æ–ª—å—â—ñ. –ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–Ω–∞ –≥—Ä–∞.">
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="theme-color" content="#0f766e">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/features.css">
  <script src="/jobs.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J3XSXPYW9K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-J3XSXPYW9K');
  </script>
  <style>
    .game-page { max-width: 960px; margin: 0 auto; padding: 1.5rem 1rem; }
    .game-hero { text-align: center; padding: 1.5rem 0 1rem; }
    .game-hero h1 { font-size: 2rem; margin-bottom: 0.4rem; }
    .game-hero p { color: var(--color-secondary,#64748b); font-size: 1rem; }
    #game-container {
      position: relative;
      width: 100%;
      max-width: 920px;
      margin: 0 auto 1.5rem;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.35);
      background: #0a0a1a;
      cursor: default;
    }
    #gameCanvas {
      display: block;
      width: 100%;
      height: auto;
    }
    .game-controls-hint {
      text-align: center;
      font-size: 0.82rem;
      color: var(--color-secondary,#64748b);
      margin-bottom: 1.5rem;
      line-height: 1.7;
    }
    .game-controls-hint kbd {
      background: #f1f5f9;
      border: 1px solid #cbd5e1;
      border-radius: 4px;
      padding: 0.1rem 0.4rem;
      font-family: monospace;
      font-size: 0.78rem;
    }
    .game-info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .game-info-card {
      background: var(--color-surface,#fff);
      border: 1px solid var(--color-border,#e5e7eb);
      border-radius: 12px;
      padding: 1rem 1.25rem;
    }
    .game-info-card h3 { font-size: 1rem; margin: 0 0 0.5rem; }
    .game-info-card ul { margin: 0; padding-left: 1.1rem; font-size: 0.88rem; color: var(--color-secondary,#64748b); }
    .game-info-card li { margin-bottom: 0.2rem; }
    @media (max-width: 600px) {
      .game-info-grid { grid-template-columns: 1fr; }
      .game-hero h1 { font-size: 1.5rem; }
      .game-controls-hint { display: none; }
      .touch-hint { display: block !important; }
    }
    /* Touch / mobile controls overlay */
    .touch-hint {
      display: none;
      text-align: center;
      font-size: 0.82rem;
      color: var(--color-secondary,#64748b);
      margin-bottom: 1.5rem;
      line-height: 1.7;
    }
    #touch-controls {
      display: none;
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 10;
    }
    #touch-controls.active { display: block; }
    .touch-btn {
      position: absolute;
      pointer-events: all;
      background: rgba(255,255,255,0.12);
      border: 2px solid rgba(255,255,255,0.30);
      border-radius: 50%;
      color: rgba(255,255,255,0.9);
      font-size: 1.25rem;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }
    .touch-btn:active { background: rgba(255,255,255,0.28); }
    #btn-left     { width: 54px; height: 54px; bottom: 18px; left: 14px; }
    #btn-right    { width: 54px; height: 54px; bottom: 18px; left: 78px; }
    #btn-jump     { width: 64px; height: 64px; bottom: 14px; right: 14px; background: rgba(0,200,130,0.18); border-color: rgba(0,200,130,0.5); }
    #btn-interact { width: 50px; height: 50px; bottom: 20px; right: 88px; background: rgba(255,215,0,0.18); border-color: rgba(255,215,0,0.45); font-size: 1rem; }
    #btn-quest    { width: 40px; height: 40px; bottom: 84px; right: 14px; font-size: 0.85rem; }
    #btn-pause    { width: 36px; height: 36px; top: 6px; right: 6px; font-size: 0.85rem; }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MJKSZ4KN" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <header class="site-header">
    <div class="container header-inner">
      <a href="/" class="logo">
        <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
        Rybezh
      </a>
      <nav class="nav-menu">
        <a href="/" class="nav-link" data-i18n="nav.home">–ì–æ–ª–æ–≤–Ω–∞</a>
        <a href="/vacancies.html" class="nav-link" data-i18n="nav.jobs">–í–∞–∫–∞–Ω—Å—ñ—ó</a>
        <a href="/blog.html" class="nav-link" data-i18n="nav.blog">–ë–ª–æ–≥</a>
        <a href="/about.html" class="nav-link" data-i18n="nav.about">–ü—Ä–æ –Ω–∞—Å</a>
        <a href="/faq.html" class="nav-link" data-i18n="nav.faq">FAQ</a>
        <a href="/contact.html" class="nav-link" data-i18n="nav.contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
        <a href="/apply.html" class="btn-cta" data-i18n="nav.cta">–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é</a>
        <div class="header-lang">
          <button class="lang-btn" data-lang="ua">UA</button>
          <button class="lang-btn" data-lang="pl">PL</button>
          <button class="lang-btn" data-lang="ru">RU</button>
        </div>
      </nav>
      <button class="mobile-toggle" aria-label="Menu" onclick="document.querySelector('.mobile-menu').classList.toggle('is-open')">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="mobile-menu">
      <a href="/" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
      <a href="/vacancies.html" class="nav-link">–í–∞–∫–∞–Ω—Å—ñ—ó</a>
      <a href="/blog.html" class="nav-link">–ë–ª–æ–≥</a>
      <a href="/about.html" class="nav-link">–ü—Ä–æ –Ω–∞—Å</a>
      <a href="/faq.html" class="nav-link">FAQ</a>
      <a href="/contact.html" class="nav-link">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
      <a href="/apply.html" class="btn-cta" style="text-align:center">–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é</a>
      <div class="mobile-lang">
        <button class="lang-btn" data-lang="ua">UA</button>
        <button class="lang-btn" data-lang="pl">PL</button>
        <button class="lang-btn" data-lang="ru">RU</button>
      </div>
    </div>
  </header>

  <main>
    <div class="game-page">
      <div class="game-hero">
        <h1>üéñÔ∏è –®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞</h1>
        <p>2D –≥—Ä–∞ –ø—Ä–æ –ø–æ—à—É–∫ —Ä–æ–±–æ—Ç–∏ —É –ü–æ–ª—å—â—ñ –ø—ñ—Å–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ —Ñ—Ä–æ–Ω—Ç—É</p>
      </div>

      <div id="game-container">
        <canvas id="gameCanvas" width="920" height="540"></canvas>
        <div id="touch-controls"></div>
      </div>

      <p class="game-controls-hint">
        <kbd>‚Üê</kbd><kbd>‚Üí</kbd> –∞–±–æ <kbd>A</kbd><kbd>D</kbd> ‚Äî —Ä—É—Ö &nbsp;|&nbsp;
        <kbd>‚Üë</kbd> –∞–±–æ <kbd>W</kbd> –∞–±–æ <kbd>–ü—Ä–æ–±—ñ–ª</kbd> ‚Äî —Å—Ç—Ä–∏–±–æ–∫ &nbsp;|&nbsp;
        <kbd>E</kbd> ‚Äî –≤–∑–∞—î–º–æ–¥—ñ—è –∑ –±—É–¥—ñ–≤–ª–µ—é / NPC &nbsp;|&nbsp;
        <kbd>Q</kbd> ‚Äî –∫–≤–µ—Å—Ç–∏ &nbsp;|&nbsp;
        <kbd>S</kbd> ‚Äî –∑–±–µ—Ä–µ–≥—Ç–∏ &nbsp;|&nbsp;
        <kbd>ESC</kbd> ‚Äî –ø–∞—É–∑–∞
      </p>

      <p class="touch-hint">
        üëÜ –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –µ–∫—Ä–∞–Ω–∞ —â–æ–± –ø–æ—á–∞—Ç–∏ &nbsp;|&nbsp;
        ‚óÄ‚ñ∂ ‚Äî —Ä—É—Ö (–ª—ñ–≤–æ—Ä—É—á –≤–Ω–∏–∑—É) &nbsp;|&nbsp;
        ‚Üë ‚Äî —Å—Ç—Ä–∏–±–æ–∫ (–ø—Ä–∞–≤–æ—Ä—É—á –≤–Ω–∏–∑—É) &nbsp;|&nbsp;
        <strong>E</strong> ‚Äî –≤–∑–∞—î–º–æ–¥—ñ—è &nbsp;|&nbsp;
        <strong>Q</strong> ‚Äî –∫–≤–µ—Å—Ç–∏
      </p>

      <div class="game-info-grid">
        <div class="game-info-card">
          <h3>üéØ –ú–µ—Ç–∞ –≥—Ä–∏</h3>
          <ul>
            <li>–ó–Ω–∞–π–¥—ñ—Ç—å —Ä–æ–±–æ—Ç—É —É –ü–æ–ª—å—â—ñ –ø—ñ—Å–ª—è —Å–ª—É–∂–±–∏</li>
            <li>–í—ñ–¥–≤—ñ–¥—É–π—Ç–µ –±—É–¥—ñ–≤–ª—ñ —Ç–∞ –ø—Ä–æ—Ö–æ–¥—å—Ç–µ —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∏</li>
            <li>–ó–±–∏—Ä–∞–π—Ç–µ –±–æ–Ω—É—Å–∏: –∫—É—Ä—Å–∏, —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏, –≥—Ä–æ—à—ñ</li>
            <li>–£–Ω–∏–∫–∞–π—Ç–µ –≤–æ—Ä–æ–≥—ñ–≤: –±—é—Ä–æ–∫—Ä–∞—Ç—ñ–≤ —Ç–∞ —à–∞—Ö—Ä–∞—ó–≤</li>
            <li>–í–∏–∫–æ–Ω—É–π—Ç–µ –∫–≤–µ—Å—Ç–∏ —Ç–∞ –ø—Ä–∏–π–º–∞–π—Ç–µ —Ä—ñ—à–µ–Ω–Ω—è</li>
          </ul>
        </div>
        <div class="game-info-card">
          <h3>üè¢ –¢–∏–ø–∏ –±—É–¥—ñ–≤–µ–ª—å</h3>
          <ul>
            <li>üîµ IT-–∫–æ–º–ø–∞–Ω—ñ—è ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω —ñ–Ω—Ç–µ–ª–µ–∫—Ç —ñ –∑–Ω–∞–Ω–Ω—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó</li>
            <li>‚öôÔ∏è –ó–∞–≤–æ–¥ / —Å–∫–ª–∞–¥ ‚Äî –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∞ –≤–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</li>
            <li>üü† –°—Ç–∞—Ä—Ç–∞–ø ‚Äî –≤–∞–∂–ª–∏–≤—ñ —Ö–∞—Ä–∏–∑–º–∞ —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è</li>
            <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å <kbd>E</kbd> –∞–±–æ –∫–Ω–æ–ø–∫—É <strong>E</strong> –ø–æ—Ä—É—á –∑ –≤—Ö–æ–¥–æ–º —â–æ–± —É–≤—ñ–π—Ç–∏</li>
          </ul>
        </div>
        <div class="game-info-card">
          <h3>‚öîÔ∏è –í–æ—Ä–æ–≥–∏</h3>
          <ul>
            <li>üëî –ë—é—Ä–æ–∫—Ä–∞—Ç ‚Äî —Å–ø–æ–≤—ñ–ª—å–Ω—é—î —Ç–∞ –ø—ñ–¥–≤–∏—â—É—î —Å—Ç—Ä–µ—Å</li>
            <li>üé≠ –®–∞—Ö—Ä–∞–π ‚Äî –∫—Ä–∞–¥–µ –≥—Ä–æ—à—ñ</li>
            <li>üò° –ü–æ–≥–∞–Ω–∏–π —Ä–æ–±–æ—Ç–æ–¥–∞–≤–µ—Ü—å ‚Äî –∫–∏–¥–∞—î –ø–∞–ø—ñ—Ä—Ü—ñ</li>
            <li>üìã –ü–æ–¥–∞—Ç–∫—ñ–≤–µ—Ü—å ‚Äî –∑–∞–±–∏—Ä–∞—î –±–æ–Ω—É—Å–∏</li>
          </ul>
        </div>
        <div class="game-info-card">
          <h3>üí° –ë–æ–Ω—É—Å–∏</h3>
          <ul>
            <li>üìö –ö—É—Ä—Å ‚Äî –ø—ñ–¥–≤–∏—â—É—î —ñ–Ω—Ç–µ–ª–µ–∫—Ç</li>
            <li>üèÜ –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç ‚Äî –ø–æ–∫—Ä–∞—â—É—î —Ä–µ–ø—É—Ç–∞—Ü—ñ—é</li>
            <li>üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è ‚Äî –ø—ñ–¥–≤–∏—â—É—î —Ö–∞—Ä–∏–∑–º—É</li>
            <li>üí∞ –ì—Ä–æ—à—ñ ‚Äî –ø–æ–ø–æ–≤–Ω—é—é—Ç—å –±—é–¥–∂–µ—Ç</li>
            <li>üíä –õ—ñ–∫–∏ ‚Äî –∑–Ω–∏–∂—É—é—Ç—å —Å—Ç—Ä–µ—Å, –≤—ñ–¥–Ω–æ–≤–ª—é—é—Ç—å –∑–¥–æ—Ä–æ–≤'—è</li>
            <li>üéñÔ∏è –ú–µ–¥–∞–ª—å ‚Äî –ø—ñ–¥–≤–∏—â—É—î –≤—ñ–π—Å—å–∫–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ —Ç–∞ —É–¥–∞—á—É</li>
            <li>ü™™ –ö–∞—Ä—Ç–∫–∞ –≤–µ—Ç–µ—Ä–∞–Ω–∞ ‚Äî –ø–æ–∫—Ä–∞—â—É—î –¥–æ–∫—É–º–µ–Ω—Ç–∏ —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—é</li>
          </ul>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-inner">
        <div class="footer-brand">
          <a href="/" class="logo">
            <svg class="logo-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
            Rybezh
          </a>
          <p data-i18n="footer.desc">–î–æ–ø–æ–º–∞–≥–∞—î–º–æ –∑–Ω–∞–π—Ç–∏ —Ä–æ–±–æ—Ç—É –≤ –ü–æ–ª—å—â—ñ —Ç–∞ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –≤–∞–∫–∞–Ω—Å—ñ—é –ø—ñ–¥ –≤–∞—à –¥–æ—Å–≤—ñ–¥. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ 24/7.</p>
        </div>
        <div class="footer-col">
          <h4 data-i18n="footer.nav">–ù–∞–≤—ñ–≥–∞—Ü—ñ—è</h4>
          <a href="/" data-i18n="nav.home">–ì–æ–ª–æ–≤–Ω–∞</a>
          <a href="/about.html" data-i18n="nav.about">–ü—Ä–æ –Ω–∞—Å</a>
          <a href="/blog.html" data-i18n="nav.blog">–ë–ª–æ–≥</a>
          <a href="/faq.html" data-i18n="nav.faq">FAQ</a>
          <a href="/contact.html" data-i18n="nav.contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
        </div>
        <div class="footer-col">
          <h4 data-i18n="footer.tools">–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏</h4>
          <a href="/calculator.html" data-i18n="footer.tool.calc">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</a>
          <a href="/cv-generator.html" data-i18n="footer.tool.cv">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä CV</a>
          <a href="/red-flag.html" data-i18n="footer.tool.redflag">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å—ñ–π</a>
          <a href="/game.html">üéÆ –ì—Ä–∞ ¬´–®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞¬ª</a>
        </div>
        <div class="footer-col">
          <h4 data-i18n="footer.contact">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h4>
          <a href="https://t.me/rybezh_site" target="_blank" rel="noopener noreferrer">Telegram: @rybezh_site</a>
          <a href="mailto:contacts@rybezh.site">contacts@rybezh.site</a>
          <a href="/apply.html" data-i18n="nav.apply">–ü–æ–¥–∞—Ç–∏ –∑–∞—è–≤–∫—É</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; <span id="year"></span> Rybezh. <span data-i18n="footer.rights">–í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</span></p>
        <div class="footer-bottom-links">
          <a href="/privacy.html" data-i18n="footer.privacy">–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a>
          <a href="/terms.html" data-i18n="footer.terms">–£–º–æ–≤–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è</a>
          <a href="/company.html" data-i18n="footer.company">–†–µ–∫–≤—ñ–∑–∏—Ç–∏</a>
          <a href="/game.html">üéÆ –ì—Ä–∞</a>
        </div>
      </div>
    </div>
  </footer>
  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>
  <div id="cookie-banner" class="cookie-banner" hidden>
    <p data-i18n="cookie.banner.text">–ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ–∞–π–ª–∏ cookie –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –≤–∞—à–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É.</p>
    <button id="cookie-accept-btn" data-i18n="cookie.banner.accept">–ü—Ä–∏–π–Ω—è—Ç–∏</button>
  </div>
  <script src="/main.js"></script>
  <script>
/* ==========================================================================
   –®–õ–Ø–• –í–ï–¢–ï–†–ê–ù–ê ‚Äî 2D Platformer Game
   Architecture: Modular IIFE, Canvas 2D, Vanilla JS
   No frameworks, no libraries, runs in any modern browser
   ========================================================================== */
(function() {
'use strict';

// ============================================================
// MODULE: GameConfig ‚Äî all constants & tuning values
// ============================================================
const CFG = {
  CANVAS_W: 920,
  CANVAS_H: 540,
  WORLD_W: 7200,
  GROUND_Y: 478,
  GRAVITY: 0.55,
  JUMP_FORCE: -13,
  PLAYER_SPEED: 4.2,
  PLAYER_W: 28,
  PLAYER_H: 40,
  FPS_CAP: 60,
  SAVE_KEY: 'veteran-path-save',
  AUTOSAVE_INTERVAL: 30000,
  CAMERA_LAG: 0.12,
  ENEMY_PATROL_SPEED: 1.4,
  ENEMY_CHASE_SPEED: 2.4,
  ENEMY_DETECT_RANGE: 180,
  PROJECTILE_SPEED: 4,
  DIALOGUE_MAX_HISTORY: 6,
};

// ============================================================
// MODULE: GameData ‚Äî world layout, templates, quests, endings
// ============================================================
const DATA = {
  /* --- Platforms [x, y, w, h] --- */
  platforms: [
    // Ground segments (fill world)
    [0, CFG.GROUND_Y, CFG.WORLD_W, 62],
    // Elevated platforms
    [320, 380, 140, 16], [560, 330, 120, 16], [780, 390, 100, 16],
    [1050, 350, 160, 16], [1350, 300, 130, 16], [1600, 380, 110, 16],
    [1900, 340, 150, 16], [2150, 290, 120, 16], [2400, 360, 140, 16],
    [2700, 320, 130, 16], [2950, 380, 110, 16], [3200, 340, 160, 16],
    [3500, 290, 140, 16], [3780, 360, 120, 16], [4050, 320, 150, 16],
    [4350, 380, 130, 16], [4600, 300, 120, 16], [4900, 350, 140, 16],
    [5200, 310, 130, 16], [5500, 380, 110, 16], [5800, 340, 150, 16],
    [6100, 300, 140, 16], [6400, 360, 120, 16], [6700, 330, 130, 16],
  ],

  /* --- Buildings [x, y, w, h, type, name] ---
     type: 0=IT, 1=Factory, 2=Startup */
  buildings: [
    [500,  320, 180, 160, 0, 'TechPol IT'],
    [1200, 330, 190, 150, 1, 'LogiPack –°–∫–ª–∞–¥'],
    [1900, 310, 185, 170, 2, 'StartHub UA'],
    [2600, 320, 185, 160, 0, 'DevCorp Poland'],
    [3300, 335, 190, 145, 1, 'MegaFactory'],
    [3900, 315, 180, 165, 2, 'InnoVenture'],
    [4600, 325, 185, 155, 0, 'CyberBridge IT'],
    [5300, 330, 190, 150, 1, 'WarehouseX'],
    [6000, 310, 185, 170, 2, 'FutureWork Hub'],
  ],

  /* --- Collectibles [x, y, type] ---
     0=course 1=cert 2=rec 3=money 4=medicine 5=plLang 6=enLang
     7=veteranMedal 8=veteranCard */
  collectibles: [
    [310, 355],[470, 470],[650, 302],[820, 465],[1020, 325],
    [1120, 465],[1300, 275],[1520, 355],[1750, 465],[1870, 315],
    [2100, 265],[2350, 335],[2550, 455],[2750, 295],[3000, 355],
    [3180, 315],[3460, 265],[3700, 335],[3950, 290],[4150, 295],
    [4400, 355],[4640, 275],[4870, 325],[5120, 285],[5370, 355],
    [5650, 315],[5870, 315],[6150, 275],[6450, 335],[6720, 305],
    [850, 465],[1470, 465],[2020, 465],[2900, 465],[3650, 465],
    [4200, 465],[4750, 465],[5450, 465],[5950, 465],[6550, 465],
  ].map((pos, i) => ({x: pos[0], y: pos[1], type: i % 7})).concat([
    {x: 600,  y: 290, type: 7}, {x: 2400, y: 265, type: 7},
    {x: 4500, y: 275, type: 7}, {x: 6300, y: 255, type: 7},
    {x: 1100, y: 355, type: 8}, {x: 3100, y: 310, type: 8},
    {x: 5200, y: 280, type: 8}, {x: 6800, y: 295, type: 8},
  ]),

  /* --- Enemies [x, patrolMin, patrolMax, type] ---
     0=Bureaucrat, 1=Scammer, 2=BadEmployer, 3=TaxAgent */
  enemies: [
    [700,  620, 850,  0],[1100, 1050, 1280, 1],[1550, 1480, 1700, 0],
    [2250, 2150, 2500, 2],[2850, 2700, 3000, 1],[3450, 3350, 3650, 3],
    [3800, 3700, 4000, 0],[4450, 4300, 4600, 1],[4800, 4700, 5000, 2],
    [5100, 5000, 5280, 3],[5600, 5450, 5750, 0],[5900, 5800, 6100, 1],
    [6300, 6200, 6500, 2],[6600, 6500, 6750, 3],[900, 800, 1050, 0],
  ],

  /* --- Friendly NPCs [x, type, name] ---
     0=veteran, 1=hr, 2=instructor, 3=lawyer */
  npcs: [
    [200,  0, '–ê–Ω–¥—Ä—ñ–π, –≤–µ—Ç–µ—Ä–∞–Ω'],
    [1800, 1, '–ú–∞—Ä—Ç–∞, HR'],
    [2800, 0, '–¢–∞—Ä–∞—Å, –≤–µ—Ç–µ—Ä–∞–Ω'],
    [3600, 3, '–ü–∞–Ω –í–æ–π—Ü–µ—Ö, —é—Ä–∏—Å—Ç'],
    [4100, 2, '–ü–∞–Ω –ù–æ–≤–∞–∫, –≤–∏–∫–ª–∞–¥–∞—á'],
    [4800, 0, '–û–ª–µ–≥, –≤–µ—Ç–µ—Ä–∞–Ω'],
    [5500, 3, '–ü–∞–Ω—ñ –ó–æ—Å—è, –∞–¥–≤–æ–∫–∞—Ç'],
    [6100, 1, '–ê–≥–Ω—î—à–∫–∞, HR'],
  ],

  /* --- Quest definitions --- */
  quests: [
    {id:'q1', name:'–ü–µ—Ä—à–∏–π –∫—Ä–æ–∫',        desc:'–ó–±–µ—Ä—ñ—Ç—å 3 –ø—Ä–µ–¥–º–µ—Ç–∏',             target:3,  type:'collect'},
    {id:'q2', name:'–ú–æ–≤–Ω–∏–π –±–∞—Ä\'—î—Ä',     desc:'–î–æ—Å—è–≥–Ω—ñ—Ç—å —Ä—ñ–≤–Ω—è –ø–æ–ª—å—Å—å–∫–æ—ó 50',   target:50, type:'polishLang'},
    {id:'q3', name:'–ü–æ—Ä—Ç—Ñ–æ–ª—ñ–æ –≥–æ—Ç–æ–≤–µ',   desc:'–ó–±–µ—Ä—ñ—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—é, —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —Ç–∞ –Ω–∞–∫–æ–ø–∏—á—Ç–µ 1500 PLN', target:3, type:'portfolio'},
    {id:'q4', name:'–ü–µ—Ä—à–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥–∞',   desc:'–ü—Ä–æ–π–¥—ñ—Ç—å –ø–µ—Ä—à—É —Å–ø—ñ–≤–±–µ—Å—ñ–¥—É',       target:1,  type:'interview'},
    {id:'q5', name:'–í–µ—Ç–µ—Ä–∞–Ω—Å—å–∫–∞ –º–µ—Ä–µ–∂–∞', desc:'–ó–Ω–∞–π–¥—ñ—Ç—å 3 –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤',            target:3,  type:'veterans'},
    {id:'q6', name:'–í–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å',     desc:'–ù–∞–∫–æ–ø–∏—á—Ç–µ 5000 PLN —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—é 70', target:1, type:'business'},
    {id:'q7', name:'–î–æ–∫—É–º–µ–Ω—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫—É',desc:'–û—Ñ–æ—Ä–º—ñ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∏ (—Ä—ñ–≤–µ–Ω—å ‚â• 60)', target:60, type:'documents'},
    {id:'q8', name:'–©–∞—Å–ª–∏–≤—á–∏–∫',          desc:'–î–æ—Å—è–≥–Ω—ñ—Ç—å —É–¥–∞—á—ñ 70',              target:70, type:'luck'},
  ],

  /* --- Lawyer dialogue lines --- */
  lawyerLines: [
    '–î–ª—è –ª–µ–≥–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∫–∞—Ä—Ç–∫–∞ –ø–æ–±–∏—Ç—É –∞–±–æ –ª–µ–≥–∞–ª—ñ–∑–∞—Ü—ñ—è.',
    '–û—Ñ–æ—Ä–º—ñ—Ç—å PESEL —Ç–∞ —Ä–∞—Ö—É–Ω–æ–∫ —É –±–∞–Ω–∫—É —è–∫–æ–º–æ–≥–∞ —à–≤–∏–¥—à–µ.',
    '–í–µ—Ç–µ—Ä–∞–Ω–∏ –º–∞—é—Ç—å –ø—Ä–∞–≤–æ –Ω–∞ –æ—Å–æ–±–ª–∏–≤–∏–π —Å—Ç–∞—Ç—É—Å —É –ü–æ–ª—å—â—ñ.',
    '–î–æ–ø–æ–º–æ–∂—É –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª—É –Ω–∞ —Ä–æ–±–æ—Ç—É.',
    '–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–≥–æ–≤—ñ—Ä –ø–µ—Ä–µ–¥ –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è–º ‚Äî —è –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ.',
    'ZUS —Ç–∞ –ø–æ–¥–∞—Ç–∫–∏ ‚Äî –≤–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏ —Å–≤–æ—ó –∑–æ–±–æ–≤\'—è–∑–∞–Ω–Ω—è.',
    '–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ ZUS –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Å—Ç—Ä–∞—Ö–æ–≤–∏—Ö –ø—Ä–∞–≤.',
    '–ö–∞—Ä—Ç–∫–∞ –≤–µ—Ç–µ—Ä–∞–Ω–∞ –¥–∞—î –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –ø—Ä–∞–≤–∞ —É –ü–æ–ª—å—â—ñ.',
  ],

  /* --- Dialogue templates (used to generate 2000+ combinations) --- */
  greetings: [
    '–î–æ–±—Ä–æ–≥–æ –¥–Ω—è! –í–∏ –ø—Ä–∏–π—à–ª–∏ –Ω–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—É?',
    '–í—ñ—Ç–∞—î–º–æ! –ú–∏ —á–µ–∫–∞–ª–∏ –Ω–∞ –≤–∞—Å.',
    '–ü—Ä–∏–≤—ñ—Ç! –ë–∞—á—É –≤–∞—à–µ CV —É –Ω–∞—à—ñ–π –±–∞–∑—ñ.',
    '–ó–¥—Ä–∞—Å—Ç—É–π—Ç–µ! –†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ —Å–µ–±–µ.',
    '–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ! –°—ñ–¥–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞.',
    '–î–æ–±—Ä–∏–π –¥–µ–Ω—å! –†–∞–¥—ñ –±–∞—á–∏—Ç–∏ –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤.',
    '–ü—Ä–∏–≤—ñ—Ç! –í–∞—à –¥–æ—Å–≤—ñ–¥ –Ω–∞—Å –∑–∞—Ü—ñ–∫–∞–≤–∏–≤.',
    '–í—ñ—Ç–∞—é! –ì–æ—Ç–æ–≤—ñ –ø—Ä–æ–π—Ç–∏ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—É?',
  ],
  itQuestions: [
    '–Ø–∫–∏–π –≤–∞—à —Ä—ñ–≤–µ–Ω—å –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è?',
    '–ß–∏ –∑–Ω–∞—î—Ç–µ –≤–∏ –æ—Å–Ω–æ–≤–∏ SQL —Ç–∞ –±–∞–∑ –¥–∞–Ω–∏—Ö?',
    '–†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ –≤–∞—à –¥–æ—Å–≤—ñ–¥ –∑ –∫–æ–º–∞–Ω–¥–Ω–∏–º–∏ –ø—Ä–æ—î–∫—Ç–∞–º–∏.',
    '–í–∞—à —Ä—ñ–≤–µ–Ω—å –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –¥–ª—è —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤?',
    '–©–æ –≤–∏ –∑–Ω–∞—î—Ç–µ –ø—Ä–æ Agile —Ç–∞ Scrum –º–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—é?',
    '–ß–∏ –¥–æ–≤–æ–¥–∏–ª–æ—Å—å –≤–∞–º –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ —Ö–º–∞—Ä–Ω–∏–º–∏ —Å–µ—Ä–≤—ñ—Å–∞–º–∏?',
    '–Ø–∫ –≤–∏ –≤–∏—Ä—ñ—à—É—î—Ç–µ —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –ø—ñ–¥ —Ç–∏—Å–∫–æ–º?',
    '–í–∞—à –¥–æ—Å–≤—ñ–¥ —É –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ—Ü—ñ?',
  ],
  factoryQuestions: [
    '–ß–∏ –º–∞—î—Ç–µ –≤–∏ –¥–æ—Å–≤—ñ–¥ —Ä–æ–±–æ—Ç–∏ –Ω–∞ –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤—ñ?',
    '–Ø–∫ –≤–∞—à–∞ —Ñ—ñ–∑–∏—á–Ω–∞ —Ñ–æ—Ä–º–∞ –¥–ª—è –≤–∞–∂–∫–æ—ó —Ä–æ–±–æ—Ç–∏?',
    '–ß–∏ —î —É –≤–∞—Å –≤–æ–¥—ñ–π—Å—å–∫—ñ –ø—Ä–∞–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó B –∞–±–æ C?',
    '–ì–æ—Ç–æ–≤—ñ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –≤ –Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏?',
    '–í–∞—à –¥–æ—Å–≤—ñ–¥ —ñ–∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á–∞–º–∏ —Ç–∞ —Ç–µ—Ö–Ω—ñ–∫–æ—é?',
    '–Ø–∫ –≤–∏ —Ä–µ–∞–≥—É—î—Ç–µ –Ω–∞ –º–æ–Ω–æ—Ç–æ–Ω–Ω—É —Ä–æ–±–æ—Ç—É?',
    '–ß–∏ –º–∞—î—Ç–µ –≤–∏ –¥–æ—Å–≤—ñ–¥ —É –ª–æ–≥—ñ—Å—Ç–∏—Ü—ñ —Ç–∞ —Å–∫–ª–∞–¥—É–≤–∞–Ω–Ω—ñ?',
    '–ì–æ—Ç–æ–≤—ñ –¥–æ —Ñ—ñ–∑–∏—á–Ω–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å 8-10 –≥–æ–¥–∏–Ω?',
  ],
  startupQuestions: [
    '–Ø–∫–∞ –≤–∞—à–∞ —Å—É–ø–µ—Ä—Å–∏–ª–∞ —É –∫–æ–º–∞–Ω–¥–Ω—ñ–π —Ä–æ–±–æ—Ç—ñ?',
    '–†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ –Ω–µ–∑–≤–∏—á–∞–π–Ω–∏–π –¥–æ—Å–≤—ñ–¥ —É –≤–∞—à–æ–º—É –∂–∏—Ç—Ç—ñ.',
    '–Ø–∫ –≤–∏ –≤–ø–æ—Ä–∞—î—Ç–µ—Å—è –∑ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–º–∏ –∑–∞–≤–¥–∞–Ω–Ω—è–º–∏?',
    '–©–æ –≤–∞—Å –º–æ—Ç–∏–≤—É—î –±—ñ–ª—å—à–µ ‚Äî –≥—Ä–æ—à—ñ —á–∏ –º—ñ—Å—ñ—è?',
    '–ß–∏ –≥–æ—Ç–æ–≤—ñ –≤–∏ –¥–æ —à–≤–∏–¥–∫–∏—Ö –∑–º—ñ–Ω —Ç–∞ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ—Å—Ç—ñ?',
    '–Ø–∫–µ –≤–∞—à–µ –±–∞—á–µ–Ω–Ω—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –Ω–∞—à–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É?',
    '–Ø–∫ –≤–∞—à –≤—ñ–π—Å—å–∫–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ –¥–æ–ø–æ–º—ñ–≥ –±–∏ –Ω–∞—à—ñ–π –∫–æ–º–∞–Ω–¥—ñ?',
    '–©–æ –≤–∏ –∑—Ä–æ–±–∏–ª–∏ –± –ø–æ-—ñ–Ω—à–æ–º—É –≤ –Ω–∞—à–æ–º—É —Å—Ç–∞—Ä—Ç–∞–ø—ñ?',
  ],
  rejections: [
    '–ù–∞ –∂–∞–ª—å, –≤–∞—à –ø—Ä–æ—Ñ—ñ–ª—å –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤–∏–º–æ–≥–∞–º.',
    '–ú–∏ —à—É–∫–∞—î–º–æ –±—ñ–ª—å—à –¥–æ—Å–≤—ñ–¥—á–µ–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.',
    '–†—ñ–≤–µ–Ω—å –≤–∞—à–∏—Ö –Ω–∞–≤–∏—á–æ–∫ —â–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π.',
    '–í–∏–±–∞—á—Ç–µ, –ø–æ–∑–∏—Ü—ñ—è –≤–∂–µ –∑–∞–∫—Ä–∏—Ç–∞.',
    '–ú–∏ –æ–±–µ—Ä–µ–º–æ —ñ–Ω—à–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.',
    '–ó–∞–π–¥—ñ—Ç—å —â–µ —Ä–∞–∑ –ø—ñ—Å–ª—è –∫—É—Ä—Å—ñ–≤ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è.',
    '–ù–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –∫–∞–Ω–¥–∏–¥–∞—Ç –∑ –±—ñ–ª—å—à–∏–º –¥–æ—Å–≤—ñ–¥–æ–º.',
    '–í–∞—à—ñ –∑–Ω–∞–Ω–Ω—è –º–æ–≤–∏ —â–µ —Ç—Ä–µ–±–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏.',
  ],
  offers: [
    '–ú–∏ —Ö–æ—á–µ–º–æ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞—Ç–∏ –≤–∞–º —Ü—é –ø–æ–∑–∏—Ü—ñ—é!',
    '–í–∏ –Ω–∞–º –ø—ñ–¥—Ö–æ–¥–∏—Ç–µ! –ü–æ—á–∏–Ω–∞—î–º–æ –≤ –ø–æ–Ω–µ–¥—ñ–ª–æ–∫?',
    '–í–∞—à –¥–æ—Å–≤—ñ–¥ —Å–∞–º–µ —Ç–µ, —â–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ!',
    '–ß—É–¥–æ–≤–æ! –ú–∏ –≥–æ—Ç–æ–≤—ñ –∑—Ä–æ–±–∏—Ç–∏ –æ—Ñ–µ—Ä –≤–∂–µ —Å—å–æ–≥–æ–¥–Ω—ñ.',
    '–í–∏ –ø—Ä–æ–π—à–ª–∏ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—É —É—Å–ø—ñ—à–Ω–æ! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!',
    'Impressed! –ü—Ä–∏—Ö–æ–¥—å—Ç–µ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –∑–∞–≤—Ç—Ä–∞.',
    '–í–∏ —Å–∞–º–µ —Ç–∞ –ª—é–¥–∏–Ω–∞, —è–∫—É –º–∏ —à—É–∫–∞–ª–∏!',
    '–í—ñ—Ç–∞—î–º–æ! –í–∞—à–µ –º—ñ—Å—Ü–µ —É –Ω–∞—à—ñ–π –∫–æ–º–∞–Ω–¥—ñ!',
  ],
  veteranLines: [
    '–ë—Ä–∞—Ç–µ, —Ç—É—Ç –Ω–µ–ø—Ä–æ—Å—Ç–æ, –∞–ª–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ä–æ–±–æ—Ç—É.',
    '–Ø —Ç–µ–∂ –ø–æ–≤–µ—Ä–Ω—É–≤—Å—è —Ä—ñ–∫ —Ç–æ–º—É. –û—Å—å –º—ñ–π –∫–æ–Ω—Ç–∞–∫—Ç.',
    '–¢—Ä–∏–º–∞–π—Å—è! –ü–µ—Ä—à—ñ –º—ñ—Å—è—Ü—ñ –Ω–∞–π–≤–∞–∂—á—ñ.',
    '–ó–Ω–∞—î—à, —è –∑–Ω–∞–π—à–æ–≤ —Ö–æ—Ä–æ—à—É —Ä–æ–±–æ—Ç—É —á–µ—Ä–µ–∑ 3 –º—ñ—Å—è—Ü—ñ.',
    '–†–µ–∫–æ–º–µ–Ω–¥—É—é —Å–ø–æ—á–∞—Ç–∫—É –≤–∏–≤—á–∏—Ç–∏ –ø–æ–ª—å—Å—å–∫—É.',
    '–ì–æ–ª–æ–≤–Ω–µ ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫—É –º–∞—Ç–∏.',
    '–í–µ—Ç–µ—Ä–∞–Ω—Å—å–∫–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è–º.',
    '–ù–µ –∑–¥–∞–≤–∞–π—Å—è! –£ –º–µ–Ω–µ –≤ –∫–æ–º–∞–Ω–¥—ñ —î —â–µ –¥–≤–æ—î –Ω–∞—à–∏—Ö.',
  ],
  hrAdvice: [
    '–í–∞—à–µ CV —Ç—Ä–µ–±–∞ –∞–¥–∞–ø—Ç—É–≤–∞—Ç–∏ –ø—ñ–¥ –ø–æ–ª—å—Å—å–∫–∏–π —Ä–∏–Ω–æ–∫.',
    '–í—ñ–π—Å—å–∫–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ ‚Äî —Ü–µ –ø–ª—é—Å, –ø—ñ–¥–∫—Ä–µ—Å–ª—ñ—Ç—å –ª—ñ–¥–µ—Ä—Å—Ç–≤–æ.',
    '–†–µ–∫–æ–º–µ–Ω–¥—É—é –ø—Ä–æ–π—Ç–∏ –∫—É—Ä—Å –ø–æ–ª—å—Å—å–∫–æ—ó –¥–æ B1 —Ä—ñ–≤–Ω—è.',
    '–ú–∏ –º–∞—î–º–æ –ø—Ä–æ–≥—Ä–∞–º—É –¥–ª—è –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤ ‚Äî –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.',
    '–í–∞—à—ñ –Ω–∞–≤–∏—á–∫–∏ ‚Äî —Ü–µ –∞–∫—Ç–∏–≤. –ü—Ä–∞–≤–∏–ª—å–Ω–æ —ó—Ö –ø—Ä–µ–∑–µ–Ω—Ç—É–π—Ç–µ.',
    '–°–ø—Ä–æ–±—É–π—Ç–µ —Å—Ç–∞–∂—É–≤–∞–Ω–Ω—è ‚Äî —Ç–∞–∫ –ª–µ–≥—à–µ –≤–ª–∞—à—Ç—É–≤–∞—Ç–∏—Å—è.',
    '–ù–µ –∑–∞–Ω–∏–∂—É–π—Ç–µ —Å–≤—ñ–π –¥–æ—Å–≤—ñ–¥ —É –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∞—Ö –ø—Ä–æ –∑–∞—Ä–ø–ª–∞—Ç—É.',
    '–°–æ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ä–µ–∂—ñ —Ç–µ–∂ –≤–∞–∂–ª–∏–≤—ñ ‚Äî LinkedIn –¥–æ–ø–æ–º–æ–∂–µ.',
  ],
  moralChoices: [
    {
      text: '–®–∞—Ö—Ä–∞–π –ø—Ä–æ–ø–æ–Ω—É—î —Ä–æ–±–æ—Ç—É –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤. –ü–æ–≥–æ–¥–∏—Ç–∏—Å—å?',
      optA: '–¢–∞–∫ (+1500 PLN, -30 —Ä–µ–ø—É—Ç–∞—Ü—ñ—è)',
      optB: '–ù—ñ (–∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–ø—É—Ç–∞—Ü—ñ—é)',
      applyA: (p) => { p.stats.finances += 1500; p.stats.reputation -= 30; p.stats.stress += 15; },
      applyB: (p) => { p.stats.reputation += 5; },
    },
    {
      text: '–í–µ—Ç–µ—Ä–∞–Ω –ø—Ä–æ—Å–∏—Ç—å –¥–æ–ø–æ–º–æ–≥—É ‚Äî –∫—É–ø–∏—Ç–∏ —ó–∂—É. –î–æ–ø–æ–º–æ–≥—Ç–∏?',
      optA: '–¢–∞–∫ (-200 PLN, +20 —Ä–µ–ø—É—Ç–∞—Ü—ñ—è)',
      optB: '–ù—ñ (–∑–±–µ—Ä–µ–≥—Ç–∏ –≥—Ä–æ—à—ñ)',
      applyA: (p) => { p.stats.finances -= 200; p.stats.reputation += 20; p.stats.mentalHealth += 10; },
      applyB: (p) => { p.stats.mentalHealth -= 8; },
    },
    {
      text: 'HR –ø—Ä–æ–ø–æ–Ω—É—î "–ø—Ä–∏—Å–∫–æ—Ä–∏—Ç–∏" –ø—Ä–æ—Ü–µ—Å –∑–∞ –≥—Ä–æ—à—ñ. –ü–ª–∞—Ç–∏—Ç–∏?',
      optA: '–¢–∞–∫ (-500 PLN, +20% —à–∞–Ω—Å –Ω–∞ –æ—Ñ–µ—Ä)',
      optB: '–ù—ñ (—á–µ—Å–Ω–∏–π —à–ª—è—Ö)',
      applyA: (p) => { p.stats.finances -= 500; p.stats.reputation -= 10; p.bribeBonus = true; },
      applyB: (p) => { p.stats.reputation += 8; },
    },
  ],

  /* --- Endings --- */
  endings: [
    {id:'it',      title:'IT-—Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç',       icon:'üíª', text:'–í–∏ —Å—Ç–∞–ª–∏ —á–∞—Å—Ç–∏–Ω–æ—é IT-–∫–æ–º–∞–Ω–¥–∏! –í–∞—à –¥–æ—Å–≤—ñ–¥ —Ç–∞ –Ω–∞–≤–∏—á–∫–∏ –¥–æ–ø–æ–º–æ–≥–ª–∏ –ø—ñ–¥–∫–æ—Ä–∏—Ç–∏ —Ü–∏—Ñ—Ä–æ–≤–∏–π Wroc≈Çaw. –ó–∞—Ä–ø–ª–∞—Ç–∞ 8000 PLN/–º—ñ—Å. üéâ'},
    {id:'factory', title:'–ù–∞—á–∞–ª—å–Ω–∏–∫ –∑–º—ñ–Ω–∏',     icon:'‚öôÔ∏è', text:'–í–∞—à–∞ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞ —Ç–∞ —Ñ—ñ–∑–∏—á–Ω–∞ –≤–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –æ—Ü—ñ–Ω–µ–Ω–∞! –í–∞—Å –ø—Ä–∏–∑–Ω–∞—á–∏–ª–∏ –Ω–∞—á–∞–ª—å–Ω–∏–∫–æ–º –∑–º—ñ–Ω–∏ –Ω–∞ –∑–∞–≤–æ–¥—ñ. 6000 PLN/–º—ñ—Å. üí™'},
    {id:'startup', title:'–ß–ª–µ–Ω —Å—Ç–∞—Ä—Ç–∞–ø—É',       icon:'üöÄ', text:'–í–∞—à–∞ —Ö–∞—Ä–∏–∑–º–∞ —Ç–∞ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –¥–æ—Å–≤—ñ–¥ —Å—Ç–∞–ª–∏ –∞–∫—Ç–∏–≤–æ–º —Å—Ç–∞—Ä—Ç–∞–ø—É! –û–ø—Ü—ñ–æ–Ω–∏ + 5000 PLN/–º—ñ—Å. –ú–∞–π–±—É—Ç–Ω—î —è—Å–∫—Ä–∞–≤–µ! ‚≠ê'},
    {id:'biz',     title:'–í–ª–∞—Å–Ω–∏–π –±—ñ–∑–Ω–µ—Å',      icon:'üè¢', text:'–í–∏ –≤—ñ–¥–∫—Ä–∏–ª–∏ –≤–ª–∞—Å–Ω–µ –ø—ñ–¥–ø—Ä–∏—î–º—Å—Ç–≤–æ! –î–æ—Å–≤—ñ–¥, –Ω–∞–∫–æ–ø–∏—á–µ–Ω—ñ –∑–≤\'—è–∑–∫–∏ —Ç–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è ‚Äî –æ—Å–Ω–æ–≤–∞ —É—Å–ø—ñ—Ö—É. –í–∏ ‚Äî –ø—ñ–¥–ø—Ä–∏—î–º–µ—Ü—å! ü¶Å'},
    {id:'vet',     title:'–õ—ñ–¥–µ—Ä –≥—Ä–æ–º–∞–¥–∏',        icon:'ü§ù', text:'–í–∏ –æ–±\'—î–¥–Ω–∞–ª–∏ –≤–µ—Ç–µ—Ä–∞–Ω—ñ–≤ —ñ —Å—Ç–∞–ª–∏ –ª—ñ–¥–µ—Ä–æ–º —Å–ø—ñ–ª—å–Ω–æ—Ç–∏! –í–∞—à–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ –¥–æ–ø–æ–º–∞–≥–∞—î —Å–æ—Ç–Ω—è–º –ª—é–¥–µ–π. ‚ù§Ô∏è'},
    {id:'bad',     title:'–í–∞–∂–∫–∏–π —á–∞—Å...',        icon:'üòî', text:'–ì—Ä–æ—à—ñ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—å... –ê–ª–µ –Ω–µ –≤—Å–µ –≤—Ç—Ä–∞—á–µ–Ω–æ. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –≤–µ—Ç–µ—Ä–∞–Ω—Å—å–∫–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å R —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑.'},
  ],
};

// ============================================================
// MODULE: StatsSystem ‚Äî 1000+ extended parameters
// Organised into 16 categories. Values are 0‚Äì100 unless noted.
// These are all derived from / intertwined with player.stats and
// affect: interview scores, dialogue, economy bonuses, quest flags.
// ============================================================
const StatsSystem = {

  /* --- Build a default extStats object (1003 keys across 16 categories) --- */
  createExtStats() {
    return {

      /* ‚îÄ‚îÄ PHYSICAL (50 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      stamina: 60,          agility: 55,          coordination: 50,
      reaction: 55,         balance: 52,          flexibility: 45,
      endurance: 65,        sprintSpeed: 50,      swimAbility: 30,
      climbAbility: 40,     liftCapacity: 60,     gripStrength: 58,
      visionAcuity: 70,     hearingSharpness: 72, smellSense: 50,
      painTolerance: 75,    heatTolerance: 55,    coldTolerance: 68,
      altitudeTolerance: 45,immuneSystemStr: 60,  healingRate: 55,
      bloodPressure: 70,    heartRateResting: 65, lungCapacity: 62,
      boneStrength: 70,     muscleRecovery: 55,   sleepQuality: 50,
      sleepHours: 6,        hydration: 65,        nutrition: 55,
      bmi: 22,              bodyFatPct: 18,       muscleMassPct: 42,
      reflexes: 58,         eyeHandCoord: 55,     fingerDexterity: 50,
      voiceClarity: 60,     postureQuality: 55,   gaitNormalcy: 70,
      woundCount: 2,        chronicPainLevel: 20, allergyCount: 1,
      medicationCount: 0,   disabilityScore: 5,   injuryRecovery: 80,
      fatigueLevel: 35,     overallFitness: 62,   physicalAge: 28,
      biologicalAge: 29,    activityLevel: 55,

      /* ‚îÄ‚îÄ PSYCHOLOGICAL (60 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      anxiety: 35,          depression: 20,       ptsdLevel: 25,
      resilienceScore: 70,  focusAbility: 60,     empathy: 55,
      motivation: 65,       selfEsteem: 55,       selfEfficacy: 60,
      optimism: 58,         pessimism: 25,        neuroticism: 30,
      extroversion: 45,     openness: 62,         conscientiousness: 70,
      agreeableness: 60,    emotionalStability: 62,impulsivity: 30,
      riskTolerance: 55,    decisionSpeed: 60,    decisionQuality: 65,
      adaptability: 68,     creativityScore: 55,  criticalThinking: 62,
      problemSolving: 60,   memoryShortTerm: 65,  memoryLongTerm: 70,
      concentrationSpan: 55,mentalClarity: 62,    cognitiveLoad: 40,
      burnoutRisk: 28,      ptsdTriggers: 3,      traumaProcessed: 55,
      therapySessionsDone: 0,sleepDisorderScore: 20,nightmareFreq: 15,
      socialAnxiety: 35,    performanceAnxiety: 30,publicSpeakFear: 40,
      confidencePublic: 50, confidenceWork: 58,   confidencePersonal: 62,
      trustInInstitutions: 35,trustInPeople: 55,  trustInSelf: 65,
      jealousy: 20,         envy: 15,             gratitude: 65,
      humility: 60,         patience: 55,         temperament: 60,
      emotionalIntelligence: 58,mindfulness: 45,  stoicismScore: 55,
      goalClarity: 58,      lifeSatisfaction: 50, purposeScore: 58,
      hopeScore: 62,        willpowerScore: 65,   habitStrength: 55,

      /* ‚îÄ‚îÄ LANGUAGES (80 params ‚Äî 8 languages √ó 10 sub-skills) */
      // Polish
      plListening: 30, plSpeaking: 25, plReading: 35, plWriting: 20,
      plVocabSize: 500, plGrammarScore: 25, plPronunciation: 22,
      plBusinessTerms: 15, plSlangKnowledge: 10, plAccentStrength: 60,
      // English
      enListening: 60, enSpeaking: 55, enReading: 70, enWriting: 62,
      enVocabSize: 4000, enGrammarScore: 65, enPronunciation: 58,
      enBusinessTerms: 55, enSlangKnowledge: 45, enAccentStrength: 30,
      // Ukrainian
      uaListening: 95, uaSpeaking: 95, uaReading: 95, uaWriting: 90,
      uaVocabSize: 15000, uaGrammarScore: 88, uaPronunciation: 95,
      uaBusinessTerms: 70, uaSlangKnowledge: 85, uaAccentStrength: 5,
      // Russian
      ruListening: 85, ruSpeaking: 80, ruReading: 85, ruWriting: 75,
      ruVocabSize: 10000, ruGrammarScore: 75, ruPronunciation: 82,
      ruBusinessTerms: 60, ruSlangKnowledge: 70, ruAccentStrength: 15,
      // German
      deListening: 8,  deSpeaking: 5,  deReading: 10, deWriting: 5,
      deVocabSize: 50, deGrammarScore: 5, dePronunciation: 8,
      deBusinessTerms: 3, deSlangKnowledge: 2, deAccentStrength: 90,
      // French
      frListening: 5,  frSpeaking: 3,  frReading: 7,  frWriting: 4,
      frVocabSize: 30, frGrammarScore: 3, frPronunciation: 5,
      frBusinessTerms: 2, frSlangKnowledge: 1, frAccentStrength: 95,
      // Czech
      czListening: 15, czSpeaking: 10, czReading: 20, czWriting: 8,
      czVocabSize: 80, czGrammarScore: 10, czPronunciation: 12,
      czBusinessTerms: 5, czSlangKnowledge: 4, czAccentStrength: 70,
      // Sign language
      slgListening: 0, slgSpeaking: 0, slgReading: 0, slgWriting: 0,
      slgVocabSize: 0, slgGrammarScore: 0, slgPronunciation: 0,
      slgBusinessTerms: 0, slgSlangKnowledge: 0, slgAccentStrength: 0,

      /* ‚îÄ‚îÄ IT / DIGITAL SKILLS (80 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      jsKnowledge: 15,      pythonKnowledge: 10,  phpKnowledge: 5,
      javaKnowledge: 8,     csharpKnowledge: 5,   cppKnowledge: 12,
      sqlKnowledge: 20,     noSqlKnowledge: 8,    htmlKnowledge: 25,
      cssKnowledge: 22,     reactKnowledge: 10,   vueKnowledge: 5,
      angularKnowledge: 3,  nodeKnowledge: 12,    dockerKnowledge: 8,
      kubernetesKnowledge: 3,awsKnowledge: 5,     azureKnowledge: 3,
      gcpKnowledge: 2,      gitKnowledge: 30,     linuxKnowledge: 25,
      windowsAdminKnowledge: 35,networkingBasics: 28,cybersecurityScore: 15,
      machineLearnScore: 5, dataAnalysisScore: 18,excelAdvanced: 40,
      wordProficiency: 55,  powerpointSkill: 45,  outlookSkill: 50,
      photoshopSkill: 20,   videoEditingSkill: 15,threeDModelingSkill: 5,
      uiUxScore: 12,        seoKnowledge: 10,     googleAdsKnowledge: 8,
      socialMediaMarketing: 25,contentWritingScore: 30,copywritingScore: 20,
      projectManagementScore: 35,agileScore: 20,  scrumScore: 18,
      kanbanScore: 25,      jiraKnowledge: 15,    confluenceKnowledge: 12,
      slackKnowledge: 45,   teamsKnowledge: 48,   zoomKnowledge: 50,
      apiDesignScore: 10,   restApiKnowledge: 15, graphqlKnowledge: 5,
      blockchainScore: 3,   aiPromptingScore: 20, dataVisualizScore: 15,
      typescriptKnowledge: 8,rustKnowledge: 2,    goKnowledge: 3,
      swiftKnowledge: 2,    kotlinKnowledge: 2,   flutterKnowledge: 3,
      reactNativeKnowledge: 5,xamarinKnowledge: 1,unityGameDevScore: 5,
      unrealEngineScore: 2, gameDesignScore: 8,   hardwareKnowledge: 22,
      printingScore3d: 5,   arduinoScore: 10,     raspberryPiScore: 8,
      iotKnowledge: 6,      embeddedSysScore: 8,  fpgaScore: 2,

      /* ‚îÄ‚îÄ TRADE / LOGISTICS / PHYSICAL WORK (70 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      forkliftLicense: 0,   truckLicenseB: 1,     truckLicenseC: 0,
      truckLicenseCE: 0,    warehouseExp: 20,     inventoryMgmt: 15,
      packingSpeed: 55,     qualityControl: 30,   productionLineExp: 20,
      cnCMachineOp: 5,      weldingSkill: 10,     electricianSkill: 15,
      plumbingSkill: 10,    carpentrySkill: 20,   paintingSkill: 25,
      constructionExp: 15,  masonry: 8,           roofingSkill: 5,
      tilingSkill: 12,      flooringSkill: 10,    hvacKnowledge: 8,
      refrigerationSkill: 5,solarPanelInstall: 3, windTurbineKnow: 2,
      foodProcessingSkill: 15,meatCuttingSkill: 10,bakingSkill: 20,
      barista: 25,          cooking: 40,          serverSkill: 30,
      bartending: 15,       cashHandling: 35,     posSystemKnowledge: 25,
      customerServiceScore: 40,callCenterExp: 10, driverExp: 30,
      deliveryRouteOptimiz: 20,supplyChainKnow: 15,exportImportKnow: 10,
      customsDocKnowledge: 8,warehouseHSKnow: 25, liftingTechniqueScore: 50,
      teamworkScore: 65,    shiftWorkTolerance: 70,nightShiftExp: 25,
      machineOperatorExp: 20,safetyAwarenessScore: 60,firstAidLevel: 40,
      fireEscapeKnow: 55,   hazmatKnowledge: 10,  chemicalSafetyScore: 15,
      radiationSafetyScore: 5,noiseSafetyKnow: 40,ergonomicsScore: 35,
      liftEquipInspect: 20, toolMaintenanceSkill: 35,stocktakingSkill: 30,

      /* ‚îÄ‚îÄ HEALTHCARE / MEDICAL (40 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      medicalKnowledge: 25,  pharmacyKnowledge: 10,nursingSkill: 5,
      firstAidCertified: 1,  cprCertified: 1,      aedCertified: 0,
      psychologyKnowledge: 20,physiotherapyScore: 5,dentalHygiene: 70,
      mentalHealthAwareness: 45,addictionResistance: 75,smokingScore: 0,
      alcoholConsumption: 10,substanceUseScore: 0, exerciseFrequency: 3,
      dietQuality: 55,       waterIntake: 60,      caffeineUse: 40,
      supplementUse: 20,     medicationAdherence: 90,doctorVisitFreq: 25,
      dentistVisitFreq: 30,  eyeDoctorVisitFreq: 20,healthInsurance: 0,
      chronicConditions: 0,  geneticRiskScore: 20, preventiveCareScore: 50,
      bloodGroupKnown: 1,    organDonorRegistered: 0,vaccineUpToDate: 1,
      covidVaccinated: 1,    fluVaccinated: 0,     travelVaccinations: 1,
      sexualHealthScore: 70, reproductiveHealthScore: 70,mentalHealthTherapy: 0,
      mindBodyBalance: 55,   painManagementScore: 60,rehabCompletion: 65,

      /* ‚îÄ‚îÄ SOCIAL & INTERPERSONAL (70 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      networkSize: 12,       closeFriendsCount: 3, acquaintancesCount: 50,
      linkedinConnections: 45,telegramGroupsMember: 8,professionalMentors: 1,
      communityInvolvement: 20,volunteerHours: 10, leadershipExp: 55,
      conflictResolution: 50,persuasionSkill: 45, negotiationSkill: 40,
      publicSpeakingScore: 35,presentationSkill: 40,activeListening: 60,
      feedbackReception: 65, feedbackGiving: 55,   mentoringSkill: 35,
      coachingSkill: 30,     teachingSkill: 40,    networkingSkill: 35,
      interviewSkill: 30,    resumeQuality: 25,    coverLetterScore: 20,
      linkedinProfileScore: 30,jobPortalActivity: 20,referencesCount: 2,
      recommendLetterCount: 0,portfolioQuality: 20,professionalBrand: 25,
      politenessScore: 75,   respectScore: 78,     integrityScore: 80,
      honestyScore: 82,      loyaltyScore: 75,     reliabilityScore: 78,
      punctualityScore: 72,  dressingProfScore: 55,hygieneScore: 75,
      bodyLanguageScore: 50, eyeContactScore: 55,  smileFrequency: 60,
      humorScore: 55,        storytellingScore: 45,persuasiveWriting: 35,
      groupDynamicsScore: 55,crossCulturalScore: 45,diversityAwareness: 50,
      inclusionScore: 48,    genderSensitivity: 65,ageDiscrimAwareness: 60,
      conflictAvoidance: 40, boundarySettingScore: 55,assertivenessScore: 50,
      diplomacyScore: 58,    tactScore: 62,        empathyActionScore: 55,
      charityGivingScore: 30,familySupportScore: 65,romanticStabilityScore: 60,
      parentingScore: 0,     elderCareScore: 0,    petResponsibilityScore: 40,

      /* ‚îÄ‚îÄ FINANCIAL & ECONOMIC (60 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      bankAccountPL: 0,      creditHistoryPL: 0,   creditScorePL: 0,
      debt: 0,               savingsRate: 5,       investmentKnow: 10,
      stockMarketKnow: 8,    cryptoKnow: 12,       realEstateKnow: 5,
      budgetingSkill: 35,    financialPlanningScore: 20,taxKnowledgePL: 10,
      taxKnowledgeUA: 40,    zusKnowledge: 5,      pitKnowledge: 8,
      vatKnowledge: 5,       insuranceKnowledge: 15,loanKnowledge: 20,
      mortgageKnowledge: 5,  pensionKnowledge: 10, euFundsKnowledge: 5,
      grantWritingScore: 5,  businessPlanScore: 10,startupKnowledge: 15,
      ecommerceKnowledge: 12,freelanceExp: 10,     selfEmployedExp: 5,
      invoicingKnowledge: 15,accountingBasics: 10, bookkeepingScore: 8,
      payrollKnowledge: 5,   hrLegislationKnow: 10,laborLawKnowledge: 15,
      contractReadingScore: 25,negotiateSalaryScore: 20,benefitsNegotiate: 15,
      equityNegotiate: 5,    bonusNegotiate: 20,   raiseNegotiate: 18,
      expenseManagement: 30, cashFlowAwareness: 25,debtManagement: 20,
      creditCardUsage: 10,   onlineBankingSkill: 55,mobilePaySkill: 60,
      cryptocurrencyHolding: 0,stocksHolding: 0,  bondsHolding: 0,
      emergencyFundMonths: 0.5,retirementSavings: 0,insuranceCoverage: 0,
      monthlyExpenses: 1200, monthlyIncome: 0,     netWorth: 2000,
      incomeStreams: 1,       passiveIncome: 0,     financialFreedomScore: 5,

      /* ‚îÄ‚îÄ MILITARY & SECURITY (80 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      combatExp: 80,         tacticsScore: 75,     strategyScore: 65,
      marksmanshipScore: 70, sniperScore: 40,      cqbScore: 65,
      grenadeUsage: 55,      explosiveSafety: 60,  mineSweeping: 30,
      droneOperation: 45,    signalIntelligence: 35,radioOperation: 55,
      militaryIntelligence: 40,counterIntelligence: 30,cryptographyScore: 20,
      survivalSkills: 70,    orienteeringScore: 65,campingSkill: 72,
      fireStartingSkill: 68, waterFindingSkill: 60,forageSkill: 45,
      trapSettingSkill: 40,  tracksReading: 50,    camouflageSkill: 65,
      escapeEvasion: 55,     prisonerEscape: 20,   resistanceToInterrog: 60,
      parachutingSkill: 10,  divingSkill: 5,       alpineSkill: 15,
      tankOperating: 5,      apcOperating: 20,     helicopterSkill: 5,
      artilleryKnowledge: 25,missileSystems: 10,   airDefenseKnow: 15,
      nbcProtection: 40,     commandLeadership: 65,officerTraining: 0,
      ncoTraining: 1,        rankAchieved: 3,      serviceYears: 2,
      combatDecorations: 1,  woundsReceived: 2,    buddiesSaved: 3,
      missionSuccess: 18,    missionFailed: 1,     powExperience: 0,
      veteranBenefitsKnow: 30,ptsdTreatmentScore: 25,warTraumaScore: 35,
      reintegrationScore: 40,civMilTransitionScore: 35,transferableSkills: 70,
      securityClearance: 0,  bodyguardSkill: 20,   securityPatrolSkill: 40,
      accessControlKnow: 30, cctvOperation: 20,    alarmSystemKnow: 25,
      crowdControlSkill: 35, eventSecuritySkill: 25,vipProtection: 10,
      cyberSecOpsScore: 10,  forensicsBasics: 5,   lawEnforceKnow: 20,

      /* ‚îÄ‚îÄ KNOWLEDGE DOMAINS (80 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      mathematicsScore: 55,  statisticsScore: 35,  physicsScore: 40,
      chemistryScore: 30,    biologyScore: 35,     geographyScore: 55,
      historyScore: 60,      philosophyScore: 35,  psychologyScore: 40,
      sociologyScore: 35,    economicsScore: 40,   politicsScore: 50,
      lawScore: 25,          ethicsScore: 65,      religionScore: 40,
      artScore: 35,          musicScore: 30,       filmScore: 45,
      literatureScore: 50,   architectureScore: 30,photographyScore: 35,
      cookingKnowledge: 45,  nutritionKnowledge: 40,gardeningScore: 20,
      automobileKnowledge: 40,motorsportScore: 15, aviationKnowledge: 10,
      maritimeKnowledge: 8,  railwayKnowledge: 12, publicTransitKnow: 50,
      urbanPlanningScore: 15,environmentalScore: 35,climateChangeKnow: 40,
      sustainabilityScore: 30,recyclingScore: 55,  animalWelfareScore: 40,
      astronomyScore: 25,    meteorologyScore: 20, geologyScore: 15,
      archaeologyScore: 20,  anthropologyScore: 20,linguisticsScore: 35,
      semioticsScore: 10,    rhetoricsScore: 35,   debatingScore: 40,
      publicAdminScore: 25,  diplomacyKnowledge: 30,internationalRelations: 25,
      humanRightsKnow: 40,   refugeeLawKnow: 30,  immigrationLawKnow: 25,
      laborLawDetailKnow: 20,euLegislationKnow: 10,constitutionKnow: 30,
      civicEducationScore: 45,mediaCriticalScore: 50,factCheckingScore: 45,
      misinformationAware: 55,propagandaResistScore: 50,digitalLiteracy: 55,
      aiAwarenessScore: 35,  privacyKnowledge: 40, gdprKnowledge: 15,

      /* ‚îÄ‚îÄ PERSONAL CIRCUMSTANCES (60 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      housingStability: 20,  hoursOfRent: 0,       rentCostPLN: 0,
      hasOwnHousing: 0,      dormitoryAccess: 0,   hotelStay: 0,
      homelessRisk: 30,      housingQuality: 30,   neighborhoodSafety: 40,
      commuteDistanceKm: 0,  commuteTimeMins: 0,   carOwnership: 0,
      bikeOwnership: 1,      publicTransitCard: 0, taxiAppUse: 10,
      foodSecurity: 45,      mealsPreparedAtHome: 5,restaurantFrequency: 1,
      foodBankUse: 0,        clothingAdequacy: 60, warmClothing: 55,
      phonePlan: 1,          internetAccess: 1,    laptopOwnership: 0,
      pcOwnership: 0,        tabletOwnership: 0,   smartphoneGen: 3,
      familyInPoland: 0,     friendsInPoland: 1,   compatriotsNearby: 5,
      localCommunityInteg: 15,churchCommunity: 0,  ukrainianOrgMember: 0,
      polishCitizenship: 0,  peselRegistered: 1,   kartaPobytu: 0,
      workPermit: 0,         temporaryProtection: 1,uaPassportValid: 1,
      uaIDValid: 1,          taxIdPL: 0,           nfzRegistered: 0,
      socialServicesAware: 20,refugeeServicesUsed: 15,jobCenterRegistered: 0,
      psychologistAccess: 0, supportGroupMember: 0,veteranOrgMember: 0,
      childrenCount: 0,      dependentsCount: 0,   maritalStatus: 0,
      partnerEmployed: 0,    parentalLeave: 0,     elderCareResponsibility: 0,

      /* ‚îÄ‚îÄ ACHIEVEMENTS & FLAGS (80 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      firstJobObtained: 0,   firstSalaryReceived: 0,firstPolishFriend: 0,
      firstInterviewPassed: 0,firstInterviewFailed: 0,firstScamAvoided: 0,
      firstScamVictim: 0,    firstMoralChoiceMade: 0,briberyUsed: 0,
      briberyRefused: 0,     helpedVeteran: 0,     helpedStranger: 0,
      reportedScammer: 0,    joinedUnion: 0,       startedBusiness: 0,
      completedITCourse: 0,  completedLanguageCourse: 0,completedDrivingCourse: 0,
      completedFirstAidCourse: 0,certificationIT: 0,certificationTrade: 0,
      certificationManagement: 0,diplomaRecognized: 0,cvCreated: 0,
      coverLetterWritten: 0, linkedinOptimized: 0, portfolioCreated: 0,
      jobApplicationsSent: 0,ghostedByEmployer: 0, salaryNegotiated: 0,
      raisedGrievance: 0,    leftJobVoluntarily: 0,leftJobForced: 0,
      mentoredSomeone: 0,    beenMentored: 0,      taughtPolish: 0,
      learnedPolishRecipe: 0,visitedPolishMuseum: 0,watchedPolishFilm: 0,
      readPolishBook: 0,     madePolishFood: 0,    attendedPolishEvent: 0,
      joinedPolishClub: 0,   integratedCommunity: 0,madeForeignFriend: 0,
      visitedChurch: 0,      doneVolunteering: 0,  donatedToCharity: 0,
      votedinUAElection: 0,  warnedOtherVeterans: 0,survivedHardWeek: 0,
      reachedFinancialGoal: 0,overcameTrauma: 0,   foundPurpose: 0,
      completedTherapy: 0,   launchedProduct: 0,   firstClientGained: 0,
      firstEmployeeHired: 0, reachedManagerLevel: 0,gotPromotion: 0,
      winAward: 0,           speakerAtEvent: 0,    interviewedByMedia: 0,
      writtenArticle: 0,     builtWebsite: 0,      createdApp: 0,
      earnedPassiveIncome: 0,savedEmergencyFund: 0,paidOffDebt: 0,

      /* ‚îÄ‚îÄ RANDOM EVENT HISTORY (80 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      rainEncounters: 0,     snowEncounters: 0,    heatWaveExp: 0,
      transportDelays: 0,    trainMissed: 0,       busMissed: 0,
      carBreakdowns: 0,      bikePunctures: 0,     phoneLost: 0,
      walletLost: 0,         documentLost: 0,      illnessDays: 0,
      hospitalVisits: 0,     emergencyRoomVisits: 0,policeContact: 0,
      borderCrossingCount: 3,customsInspected: 0,  taxAuditExp: 0,
      lawsuitExp: 0,         courtVisits: 0,       finesPaid: 0,
      corruptionEncountered: 2,harassmentExp: 0,   discriminationExp: 1,
      racismExp: 0,          xenophobiaExp: 1,     workplaceConflicts: 0,
      neighborConflicts: 0,  familyConflicts: 0,   romanticBreakup: 0,
      friendshipLost: 0,     betrayalExp: 0,       backstabbingExp: 0,
      unfairTreatment: 2,    positiveMedia: 0,     negativeSocialMedia: 0,
      viralMoment: 0,        prizeWon: 0,          lotteryTickets: 0,
      luckyEvents: 3,        unluckyEvents: 2,     serendipityScore: 5,
      mentorshipReceived: 1, scholarshipReceived: 0,grantReceived: 0,
      promotionOffered: 0,   promotionRejected: 0, raiseOffered: 0,
      raisedRefused: 0,      jobOfferReceived: 0,  jobOfferRejected: 0,
      referralReceived: 1,   recommendationGiven: 0,goodReferenceScore: 2,
      badReferenceScore: 0,  exitInterviewDone: 0, performanceReview: 0,
      warningLetterReceived: 0,probationPassed: 0, contractRenewed: 0,
      layoffExp: 0,          strikeParticipation: 0,whistleblowingExp: 0,
      whistleblowingRetaliation: 0,workAccident: 0,injuryAtWork: 0,
      nearMissAtWork: 0,     equipmentBreakage: 0, customerComplaint: 0,
      customerPraise: 0,     teamBonding: 0,       teamConflict: 0,
      projectSuccess: 0,     projectFailure: 0,    deadlineMissed: 0,
      overtimeHours: 0,      paidOvertimeRate: 0,  unpaidOvertimeHours: 0,

      /* ‚îÄ‚îÄ HABITS & LIFESTYLE (60 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      wakeUpTime: 7,          bedTime: 23,          sleepConsistency: 55,
      morningRoutineScore: 40,eveningRoutineScore: 35,productivityRating: 55,
      procrastinationScore: 35,distractionLevel: 40,deepWorkHours: 2,
      readingBooksPerMonth: 0.5,podcastsPerWeek: 1,youtubeHoursDay: 2,
      socialMediaHoursDay: 1.5,tvHoursDay: 1,      gamingHoursDay: 0,
      exerciseDaysPerWeek: 2, gymMembership: 0,    runningKmPerWeek: 5,
      swimmingSessionsMonth: 0,cyclingKmPerWeek: 10,sportsTeamMember: 0,
      meditationMinutesDay: 0,journalingScore: 0,  gratitudeJournal: 0,
      hobbyHoursPerWeek: 3,   hobbyCount: 2,       learningHoursWeek: 2,
      onlineCourseActive: 0,  bookClubMember: 0,   toastmastersAttend: 0,
      networkingEventsMonth: 0,webinarsMonth: 0,   conferenceYearly: 0,
      travelDaysPerYear: 5,   countriesVisited: 3, culturalExpScore: 35,
      cookingHoursWeek: 3,    mealPrepScore: 40,   groceryBudget: 200,
      alcoholFreeDays: 25,    caffeineFreeDays: 5, sugarIntakeScore: 40,
      fastFoodFrequency: 2,   homeCooked: 5,       snackingScore: 50,
      hydrationScore: 55,     outdoorTimeHoursDay: 1,sunlightExposure: 45,
      screenTimeHoursDay: 7,  blueFilterUsed: 0,   ergonomicSetup: 20,
      standingDeskUsage: 0,   breakFrequency: 3,   vacationDaysTaken: 0,
      stressManagementScore: 45,workLifeBalance: 40,boundaryWorkPersonal: 45,

      /* ‚îÄ‚îÄ CREATIVE & ARTS (40 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      drawingSkill: 10,      paintingSkill2D: 8,   sculptingSkill: 5,
      illustrationScore: 12, graphicDesignScore: 15,logoDesignScore: 10,
      vectorArtScore: 12,    motionGraphicsScore: 8,animationScore: 5,
      comicArtScore: 6,      caricatureScore: 4,    streetArtScore: 3,
      poetryWritingScore: 20,fictionWritingScore: 18,blogWritingScore: 25,
      journalismScore: 15,   scriptwritingScore: 10,songwritingScore: 8,
      musicComposition: 10,  singSkill: 12,         guitarSkill: 8,
      pianoSkill: 5,         drumSkill: 4,          djSkill: 6,
      danceScore: 20,        theatreActingScore: 10,voiceActingScore: 8,
      filmDirectingScore: 5, videoProductionScore: 12,podcastProductionScore: 10,
      comedyScore: 15,       improvisationScore: 18,magicTricksScore: 5,
      origamiScore: 8,       crochetScore: 5,       knittingScore: 4,
      sewingScore: 10,       leatherworkScore: 5,   jewelryMakingScore: 3,
      ceramicsScore: 6,      glassworkScore: 3,     etchingScore: 4,

      /* ‚îÄ‚îÄ DIGITAL CREATION & MEDIA (40 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      contentCreatorScore: 15,youtubeChannelScore: 5,instagramScore: 10,
      tiktokScore: 8,         twitterScore: 12,     facebookPageScore: 8,
      linkedinContentScore: 18,newsletterScore: 10, podcastAudienceSize: 0,
      youtubeSubscribers: 0,  instagramFollowers: 45,twitterFollowers: 12,
      patronsCount: 0,        gumroadSalesCount: 0, udemyCoursesMade: 0,
      githubStars: 0,         npmDownloads: 0,      openSourceContribs: 0,
      productHuntUpvotes: 0,  appStoreApps: 0,      playStoreApps: 0,
      websitesBuilt: 0,       onlineShopsMade: 0,   freelancePlatformScore: 10,
      upworkRating: 0,        fiverrGigsCount: 0,   toptalApproved: 0,
      remoteWorkScore: 35,    asyncWorkScore: 40,   digitalNomadScore: 5,
      versionControlScore: 30,codeReviewScore: 20,  pairProgrammingScore: 15,
      documentationScore: 25, technicalWritingScore: 20,knowledgeShareScore: 30,
      onlineLearningPlatform: 1,moocCompletionRate: 20,certificationOnline: 0,
      languageLearningApp: 1, dailyLearningStreak: 3,teachOthersOnline: 0,

      /* ‚îÄ‚îÄ SPORTS & RECREATION (35 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      footballSkill: 30,     basketballSkill: 15,  volleyballSkill: 20,
      tennisSkill: 10,       tableTennis: 25,       badmintonSkill: 12,
      boxingSkill: 35,       martialArts: 30,       wrestlingSkill: 20,
      judo: 15,              karate: 10,            aikido: 5,
      fencing: 5,            archerySkill: 15,      handballSkill: 10,
      rugbySkill: 5,         cricketSkill: 3,       baseballSkill: 3,
      golfSkill: 5,          bowlingSkill: 20,      darts: 25,
      billiards: 20,         chessScore: 40,        checkersScore: 30,
      cardsGamesScore: 45,   videoGamesScore: 30,   boardGamesScore: 35,
      hikingScore: 55,       rockClimbingScore: 20, skiingScore: 15,
      snowboardingScore: 10, surfingScore: 5,       horsebackRiding: 8,
      fishing: 25,           hunting: 10,           airsoft: 20,
      paintball: 15,         geocachingScore: 10,   escapeRoomScore: 30,

      /* ‚îÄ‚îÄ ENTREPRENEURSHIP (15 params) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
      businessIdeaCount: 1,  businessPlanWritten: 0,pitchDeckScore: 5,
      investorMeetingsDone: 0,coFounderFound: 0,    productMVPBuilt: 0,
      firstRevenueEarned: 0, customerDiscoveryDone: 0,pivotsDone: 0,
      acceleratorApplied: 0, acceleratorAccepted: 0,equipmentOwned: 0,
      officeSpaceAccess: 0,  businessRegistered: 0, vatRegistered: 0,

    }; // end extStats ‚Äî 1003 keys across 16 categories
  },

  /* --- Derive a bonus score from extStats for interview evaluation --- */
  getInterviewBonus(extStats, buildingType) {
    if (!extStats) return 0;
    let bonus = 0;
    if (buildingType === 0) { // IT
      bonus += (extStats.jsKnowledge + extStats.pythonKnowledge + extStats.sqlKnowledge) * 0.04;
      bonus += (extStats.enListening + extStats.enSpeaking) * 0.025;
      bonus += extStats.gitKnowledge * 0.03;
      bonus += extStats.agileScore * 0.02;
      bonus += extStats.conscientiousness * 0.02;
      bonus += extStats.focusAbility * 0.015;
      bonus += extStats.problemSolving * 0.02;
    } else if (buildingType === 1) { // Factory
      bonus += extStats.stamina * 0.04;
      bonus += extStats.endurance * 0.04;
      bonus += extStats.liftCapacity * 0.03;
      bonus += extStats.warehouseExp * 0.05;
      bonus += extStats.safetyAwarenessScore * 0.02;
      bonus += extStats.teamworkScore * 0.02;
      bonus += extStats.punctualityScore * 0.02;
    } else { // Startup
      bonus += extStats.networkSize * 0.03;
      bonus += extStats.leadershipExp * 0.04;
      bonus += extStats.creativityScore * 0.04;
      bonus += extStats.adaptability * 0.03;
      bonus += extStats.linkedinConnections * 0.04;
      bonus += extStats.startupKnowledge * 0.05;
      bonus += extStats.negotiationSkill * 0.03;
    }
    // Universal bonuses
    bonus += extStats.plSpeaking * 0.02;
    bonus += extStats.resumeQuality * 0.04;
    bonus += extStats.interviewSkill * 0.05;
    bonus += extStats.punctualityScore * 0.01;
    bonus += (extStats.anxiety > 60 ? -extStats.anxiety * 0.05 : 0);
    bonus += (extStats.ptsdLevel > 50 ? -extStats.ptsdLevel * 0.03 : 0);
    return Math.min(20, Math.max(-15, Math.round(bonus)));
  },

  /* --- Build extra greeting lines from extStats --- */
  getGreetingExtra(extStats) {
    if (!extStats) return '';
    const notes = [];
    if (extStats.resumeQuality > 60) notes.push('–í–∞—à–µ CV –≤–∏–≥–ª—è–¥–∞—î –¥—É–∂–µ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ!');
    if (extStats.plSpeaking > 50) notes.push('–ü–æ–ª—å—Å—å–∫–∞ –º–æ–≤–∞ –º–∞–π–∂–µ —ñ–¥–µ–∞–ª—å–Ω–∞.');
    if (extStats.combatExp > 70) notes.push('–í–∞—à –±–æ–π–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ ‚Äî —Ü–µ —Å–∏–ª—å–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞.');
    if (extStats.networkSize > 40) notes.push('–ß—É–¥–æ–≤—ñ –∑–≤\'—è–∑–∫–∏ —É –≤–∞—à–æ–º—É –ø—Ä–æ—Ñ—ñ–ª—ñ!');
    if (extStats.anxiety > 70) notes.push('–ù–µ —Ö–≤–∏–ª—é–π—Ç–µ—Å—è, –º–∏ —Ç—É—Ç –ª–∏—à–µ –ø–æ–≥–æ–≤–æ—Ä–∏–º–æ.');
    if (extStats.conscientiousness > 75) notes.push('–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –≤–∏–¥–Ω–∞ –æ–¥—Ä–∞–∑—É.');
    if (extStats.linkedinConnections > 100) notes.push('LinkedIn –ø—Ä–æ—Ñ—ñ–ª—å —Å–ø—Ä–∞–≤–ª—è—î –≤—Ä–∞–∂–µ–Ω–Ω—è.');
    if (extStats.ptsdLevel > 55) notes.push('–ú–∏ —Ä–æ–∑—É–º—ñ—î–º–æ ‚Äî –∞–¥–∞–ø—Ç–∞—Ü—ñ—è –ø–æ—Ç—Ä–µ–±—É—î —á–∞—Å—É.');
    if (notes.length === 0) return '';
    return ' ' + notes[Math.floor(Math.random() * notes.length)];
  },

  /* --- Tick: some extStats evolve over time --- */
  tick(extStats, frame) {
    if (!extStats) return;
    // Gradual improvements from passive time
    if (frame % 900 === 0) {
      extStats.plListening  = Math.min(100, extStats.plListening + 0.2);
      extStats.plSpeaking   = Math.min(100, extStats.plSpeaking + 0.15);
      extStats.plReading    = Math.min(100, extStats.plReading + 0.2);
      extStats.stamina      = Math.min(100, extStats.stamina + 0.1);
      extStats.networkSize  = Math.min(200, extStats.networkSize + 0.05);
      extStats.anxiety      = Math.max(0, extStats.anxiety - 0.1);
      extStats.resilienceScore = Math.min(100, extStats.resilienceScore + 0.05);
      extStats.jobApplicationsSent++;
      extStats.hoursOfRent  += 0.001;
    }
    // Interview skill grows with each interview
    extStats.jobApplicationsSent = Math.max(0, extStats.jobApplicationsSent);
  },

  /* --- Apply collectible bonus to extStats --- */
  applyCollectible(extStats, type) {
    if (!extStats) return;
    switch (type) {
      case 0: // Course (book) ‚Üí IT + cognitive
        extStats.jsKnowledge       = Math.min(100, extStats.jsKnowledge + 3);
        extStats.criticalThinking  = Math.min(100, extStats.criticalThinking + 2);
        extStats.learningHoursWeek = Math.min(40, extStats.learningHoursWeek + 0.5);
        break;
      case 1: // Certificate ‚Üí professional brand
        extStats.resumeQuality     = Math.min(100, extStats.resumeQuality + 5);
        extStats.professionalBrand = Math.min(100, extStats.professionalBrand + 4);
        extStats.certificationIT   = Math.max(0, extStats.certificationIT + 1);
        break;
      case 2: // Recommendation ‚Üí social / network
        extStats.referencesCount   = Math.min(20, extStats.referencesCount + 1);
        extStats.networkSize       = Math.min(200, extStats.networkSize + 5);
        extStats.interviewSkill    = Math.min(100, extStats.interviewSkill + 3);
        break;
      case 3: // Money ‚Üí financial params
        extStats.savingsRate       = Math.min(100, extStats.savingsRate + 2);
        extStats.netWorth          += 300;
        extStats.financialFreedomScore = Math.min(100, extStats.financialFreedomScore + 1);
        break;
      case 4: // Medicine ‚Üí health params
        extStats.fatigueLevel      = Math.max(0, extStats.fatigueLevel - 10);
        extStats.anxiety           = Math.max(0, extStats.anxiety - 8);
        extStats.sleepQuality      = Math.min(100, extStats.sleepQuality + 5);
        extStats.immuneSystemStr   = Math.min(100, extStats.immuneSystemStr + 4);
        break;
      case 5: // Polish course ‚Üí all PL sub-skills
        extStats.plListening    = Math.min(100, extStats.plListening + 6);
        extStats.plSpeaking     = Math.min(100, extStats.plSpeaking + 5);
        extStats.plReading      = Math.min(100, extStats.plReading + 7);
        extStats.plWriting      = Math.min(100, extStats.plWriting + 5);
        extStats.plVocabSize    = Math.min(10000, extStats.plVocabSize + 200);
        extStats.plGrammarScore = Math.min(100, extStats.plGrammarScore + 5);
        extStats.completedLanguageCourse = 1;
        break;
      case 6: // English course ‚Üí all EN sub-skills
        extStats.enListening    = Math.min(100, extStats.enListening + 5);
        extStats.enSpeaking     = Math.min(100, extStats.enSpeaking + 4);
        extStats.enVocabSize    = Math.min(20000, extStats.enVocabSize + 150);
        extStats.enBusinessTerms= Math.min(100, extStats.enBusinessTerms + 4);
        extStats.completedLanguageCourse = 1;
        break;
      case 7: // Veteran medal ‚Üí military + resilience + luck
        extStats.resilienceScore    = Math.min(100, extStats.resilienceScore + 6);
        extStats.leadershipExp      = Math.min(100, (extStats.leadershipExp || 0) + 5);
        extStats.combatExp          = Math.min(100, (extStats.combatExp || 0) + 5);
        extStats.confidenceWork     = Math.min(100, extStats.confidenceWork + 4);
        break;
      case 8: // Veteran card ‚Üí documents / legal / stress
        extStats.resumeQuality      = Math.min(100, extStats.resumeQuality + 4);
        extStats.professionalBrand  = Math.min(100, extStats.professionalBrand + 5);
        extStats.anxiety            = Math.max(0, extStats.anxiety - 6);
        extStats.trustInInstitutions= Math.min(100, extStats.trustInInstitutions + 8);
        break;
    }
  },

  /* --- Count total keys in extStats --- */
  count(extStats) {
    return extStats ? Object.keys(extStats).length : 0;
  },

  /* --- Summarise notable extStats for the HUD --- */
  getTopHighlights(extStats) {
    if (!extStats) return '';
    const h = [];
    if (extStats.plSpeaking > 30) h.push(`PL:${Math.round(extStats.plSpeaking)}%`);
    if (extStats.jsKnowledge > 20) h.push(`JS:${Math.round(extStats.jsKnowledge)}`);
    if (extStats.resumeQuality > 30) h.push(`CV:${Math.round(extStats.resumeQuality)}`);
    if (extStats.stamina > 50) h.push(`–í–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å:${Math.round(extStats.stamina)}`);
    if (extStats.networkSize > 5) h.push(`–ú–µ—Ä–µ–∂–∞:${Math.round(extStats.networkSize)}`);
    return h.slice(0, 4).join(' ¬∑ ');
  },
};

// ============================================================
// MODULE: SaveSystem
// ============================================================
const SaveSystem = {
  save(gameState) {
    try {
      const data = {
        v: 3,
        ts: Date.now(),
        stats: { ...gameState.player.stats },
        extStats: { ...gameState.player.extStats },
        x: Math.round(gameState.player.x),
        quests: JSON.parse(JSON.stringify(gameState.quests)),
        questsDone: [...gameState.questsDone],
        collected: gameState.collected,
        interviewsDone: gameState.interviewsDone,
        veteransMet: gameState.veteransMet,
        moralChoicesDone: gameState.moralChoicesDone,
      };
      localStorage.setItem(CFG.SAVE_KEY, JSON.stringify(data));
      return true;
    } catch(e) { return false; }
  },
  load() {
    try {
      const raw = localStorage.getItem(CFG.SAVE_KEY);
      if (!raw) return null;
      const d = JSON.parse(raw);
      if (!d || d.v < 2) return null;
      return d;
    } catch(e) { return null; }
  },
  clear() { localStorage.removeItem(CFG.SAVE_KEY); },
};

// ============================================================
// MODULE: Physics ‚Äî AABB collision helpers
// ============================================================
const Physics = {
  rectOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  },
  resolveCollision(entity, platforms) {
    entity.onGround = false;
    for (const p of platforms) {
      const [px, py, pw, ph] = p;
      if (!Physics.rectOverlap(entity.x, entity.y, entity.w, entity.h, px, py, pw, ph)) continue;
      // overlap amounts
      const overlapL = (entity.x + entity.w) - px;
      const overlapR = (px + pw) - entity.x;
      const overlapT = (entity.y + entity.h) - py;
      const overlapB = (py + ph) - entity.y;
      const minH = Math.min(overlapL, overlapR);
      const minV = Math.min(overlapT, overlapB);
      if (minV < minH) {
        if (overlapT < overlapB) {
          entity.y = py - entity.h;
          entity.vy = 0;
          entity.onGround = true;
        } else {
          entity.y = py + ph;
          if (entity.vy < 0) entity.vy = 0;
        }
      } else {
        if (overlapL < overlapR) { entity.x = px - entity.w; entity.vx = 0; }
        else { entity.x = px + pw; entity.vx = 0; }
      }
    }
  },
};

// ============================================================
// MODULE: DialogueSystem
// ============================================================
const DialogueSystem = {
  /* Pick random element from array */
  rnd(arr) { return arr[Math.floor(Math.random() * arr.length)]; },

  /* Build contextual greeting based on player stats */
  buildGreeting(stats, extStats) {
    const base = this.rnd(DATA.greetings);
    const extras = [];
    if (stats.militaryExp > 60) extras.push('–í–∞—à –≤—ñ–π—Å—å–∫–æ–≤–∏–π –¥–æ—Å–≤—ñ–¥ –≤—Ä–∞–∂–∞—î!');
    if (stats.polishLang > 50) extras.push('–í–∞—à–∞ –ø–æ–ª—å—Å—å–∫–∞ –¥—É–∂–µ –≥–∞—Ä–Ω–∞!');
    if (stats.reputation > 55) extras.push('–ß—É–≤ –ø—Ä–æ –≤–∞—à—É —Ä–µ–ø—É—Ç–∞—Ü—ñ—é ‚Äî –¥—É–∂–µ –¥–æ–±—Ä–µ.');
    if (stats.stress > 60) extras.push('–í–∏ –≤–∏–≥–ª—è–¥–∞—î—Ç–µ –≤—Ç–æ–º–ª–µ–Ω–∏–º. –í—Å–µ –≥–∞—Ä–∞–∑–¥?');
    const extra = extras.length ? ' ' + this.rnd(extras) : '';
    const extExtra = StatsSystem.getGreetingExtra(extStats);
    return base + extra + extExtra;
  },

  /* Build interview question based on building type + stats */
  buildQuestion(buildingType, stats) {
    const pool = buildingType === 0 ? DATA.itQuestions :
                 buildingType === 1 ? DATA.factoryQuestions : DATA.startupQuestions;
    const q = this.rnd(pool);
    // Contextual follow-up
    const followUps = [];
    if (buildingType === 0 && stats.intelligence < 50) followUps.push('–ù–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –≤–∏—â–∏–π —Ä—ñ–≤–µ–Ω—å —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –∑–Ω–∞–Ω—å.');
    if (buildingType === 0 && stats.englishLang < 40) followUps.push('–¢–∞–∫–æ–∂ –≤–∞–∂–ª–∏–≤–∏–π —Ä—ñ–≤–µ–Ω—å –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó B2+.');
    if (buildingType === 1 && stats.strength < 50) followUps.push('–¶—è —Ä–æ–±–æ—Ç–∞ –≤–∏–º–∞–≥–∞—î —Ö–æ—Ä–æ—à–æ—ó —Ñ—ñ–∑–∏—á–Ω–æ—ó —Ñ–æ—Ä–º–∏.');
    if (buildingType === 2 && stats.charisma < 45) followUps.push('–ù–∞–º –≤–∞–∂–ª–∏–≤—ñ –Ω–∞–≤–∏—á–∫–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó.');
    if (stats.militaryExp > 70) followUps.push('–í–∞—à –∞—Ä–º—ñ–π—Å—å–∫–∏–π –¥–æ—Å–≤—ñ–¥ –∫–æ–º–∞–Ω–¥—É–≤–∞–Ω–Ω—è –¥—É–∂–µ —Ü—ñ–∫–∞–≤–∏–π.');
    const followUp = followUps.length ? ' ' + this.rnd(followUps) : '';
    return q + followUp;
  },

  /* Evaluate interview outcome based on stats + building type */
  evaluateInterview(buildingType, stats, bribeBonus, extStats) {
    let score = 0;
    const reqs = [];

    if (buildingType === 0) {
      // IT company requirements
      score += Math.min(stats.intelligence, 100) * 0.35;
      score += Math.min(stats.englishLang, 100) * 0.25;
      score += Math.min(stats.civilExp, 100) * 0.20;
      score += Math.min(stats.reputation, 100) * 0.20;
      if (stats.intelligence < 60) reqs.push('—ñ–Ω—Ç–µ–ª–µ–∫—Ç < 60');
      if (stats.englishLang < 50) reqs.push('–∞–Ω–≥–ª—ñ–π—Å—å–∫–∞ < 50');
    } else if (buildingType === 1) {
      // Factory requirements
      score += Math.min(stats.strength, 100) * 0.40;
      score += Math.min(stats.health, 100) * 0.30;
      score += Math.min(stats.militaryExp, 100) * 0.20;
      score += Math.min(stats.polishLang, 100) * 0.10;
      if (stats.strength < 55) reqs.push('—Å–∏–ª–∞ < 55');
      if (stats.health < 60) reqs.push('–∑–¥–æ—Ä–æ–≤\'—è < 60');
    } else {
      // Startup requirements
      score += Math.min(stats.charisma, 100) * 0.35;
      score += Math.min(stats.reputation, 100) * 0.30;
      score += Math.min(stats.intelligence, 100) * 0.20;
      score += Math.min(stats.polishLang, 100) * 0.15;
      if (stats.charisma < 50 && stats.reputation < 60) reqs.push('—Ö–∞—Ä–∏–∑–º–∞ –∞–±–æ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è –∑–∞–Ω–∏–∑—å–∫—ñ');
    }

    // Apply extended stats bonus/penalty (up to ¬±20 points)
    score += StatsSystem.getInterviewBonus(extStats, buildingType);

    if (bribeBonus) score += 20;
    if (stats.stress > 70) score -= 15;
    if (stats.mentalHealth < 40) score -= 10;
    // Luck factor: slight random boost/penalty scaled by luck stat
    if (stats.luck !== undefined) score += (stats.luck - 50) * 0.1 + (Math.random() * 6 - 3) * (stats.luck / 100);
    // Documents factor: proper paperwork helps
    if (stats.documents !== undefined) score += stats.documents * 0.05;

    const passed = score >= 50;
    const responseText = passed ? this.rnd(DATA.offers) : this.rnd(DATA.rejections);
    return { passed, score: Math.round(score), requirements: reqs, text: responseText };
  },

  /* Generate NPC dialogue lines (veteran / hr / instructor / lawyer) */
  buildNPCDialogue(npcType, stats, veteransMet) {
    if (npcType === 0) { // veteran
      const base = this.rnd(DATA.veteranLines);
      const bonus = veteransMet >= 2 ? ' –ù–∞—Å –≤–∂–µ —Ç—Ä–æ—î —Ç—É—Ç ‚Äî –∑—É—Å—Ç—Ä—ñ–Ω–µ–º–æ—Å—è –≤–≤–µ—á–µ—Ä—ñ!' : '';
      return base + bonus;
    } else if (npcType === 1) { // hr
      const base = this.rnd(DATA.hrAdvice);
      const statsNote = stats.reputation > 60 ? ' –í–∞—à–∞ —Ä–µ–ø—É—Ç–∞—Ü—ñ—è –≤–∂–µ –¥–æ–±—Ä–∞ ‚Äî –ø—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ!' :
                        stats.polishLang < 40 ? ' –ù–∞–π–±—ñ–ª—å—à–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞—Ä–∞–∑ ‚Äî –º–æ–≤–∞. –ö—É—Ä—Å–∏ ‚Äî –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç.' : '';
      return base + statsNote;
    } else if (npcType === 2) { // instructor
      const tips = [
        '–£—Ä–æ–∫ 1: Po polsku ‚Äî Dzie≈Ñ dobry! –î–æ–±—Ä–∏–π –¥–µ–Ω—å!',
        '–£—Ä–æ–∫ 2: Jak masz na imiƒô? ‚Äî –Ø–∫ —Ç–µ–±–µ –∑–≤–∞—Ç–∏?',
        '–£—Ä–æ–∫ 3: Gdzie jest praca? ‚Äî –î–µ —î —Ä–æ–±–æ—Ç–∞?',
        '–£—Ä–æ–∫ 4: Ile zarabiasz? ‚Äî –°–∫—ñ–ª—å–∫–∏ —Ç–∏ –∑–∞—Ä–æ–±–ª—è—î—à?',
        '–£—Ä–æ–∫ 5: Potrzebujƒô pomocy. ‚Äî –ú–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞.',
        '–¶–µ–π —É—Ä–æ–∫ +10 –¥–æ –∑–Ω–∞–Ω—å –ø–æ–ª—å—Å—å–∫–æ—ó!',
      ];
      return this.rnd(tips);
    } else { // lawyer (type 3)
      const base = this.rnd(DATA.lawyerLines);
      const docNote = stats.documents !== undefined && stats.documents < 50
        ? ' –í–∞—à—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å —É–≤–∞–≥–∏! +10 –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤.'
        : ' –í–∞—à—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤ –ø–æ—Ä—è–¥–∫—É. –¢–∞–∫ —Ç—Ä–∏–º–∞—Ç–∏!';
      return base + docNote;
    }
  },
};

// ============================================================
// MODULE: EconomySystem ‚Äî job market simulation
// ============================================================
const EconomySystem = {
  itDemand: 75,
  factoryDemand: 65,
  startupDemand: 55,
  tick(frame) {
    if (frame % 600 === 0) {
      this.itDemand      = Math.max(20, Math.min(100, this.itDemand      + (Math.random() * 10 - 5)));
      this.factoryDemand = Math.max(20, Math.min(100, this.factoryDemand + (Math.random() * 10 - 5)));
      this.startupDemand = Math.max(20, Math.min(100, this.startupDemand + (Math.random() * 10 - 5)));
    }
  },
  getDemand(type) {
    return [this.itDemand, this.factoryDemand, this.startupDemand][type] || 50;
  },
};

// ============================================================
// MODULE: Entities
// ============================================================
class Entity {
  constructor(x, y, w, h) {
    this.x = x; this.y = y; this.w = w; this.h = h;
    this.vx = 0; this.vy = 0;
    this.onGround = false;
    this.alive = true;
    this.frame = 0;
  }
  applyGravity() { this.vy += CFG.GRAVITY; }
  move() { this.x += this.vx; this.y += this.vy; }
}

class Player extends Entity {
  constructor(x, y) {
    super(x, y, CFG.PLAYER_W, CFG.PLAYER_H);
    this.stats = {
      health: 100, strength: 50, intelligence: 50, charisma: 45,
      militaryExp: 80, stress: 30, mentalHealth: 70,
      finances: 2000, reputation: 40, polishLang: 30,
      englishLang: 60, civilExp: 20,
      luck: 50,       // —É–¥–∞—á–∞ ‚Äî –≤–ø–ª–∏–≤–∞—î –Ω–∞ —É—Å–ø—ñ—Ö —Å–ø—ñ–≤–±–µ—Å—ñ–¥ —ñ –≤–∑–∞—î–º–æ–¥—ñ–π
      documents: 30,  // —Ä—ñ–≤–µ–Ω—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
    };
    // Extended parameters (1003 values across 16 categories)
    this.extStats = StatsSystem.createExtStats();
    this.facingRight = true;
    this.invincible = 0;      // frames of invincibility after hit
    this.slowTimer = 0;       // bureaucrat slow effect
    this.bribeBonus = false;
    this.animFrame = 0;
    this.animTimer = 0;
  }

  update(input, platforms) {
    this.frame++;
    if (this.invincible > 0) this.invincible--;
    if (this.slowTimer > 0) this.slowTimer--;

    const speed = this.slowTimer > 0 ? CFG.PLAYER_SPEED * 0.45 : CFG.PLAYER_SPEED;

    // Horizontal movement
    this.vx = 0;
    if (input.left)  { this.vx = -speed; this.facingRight = false; }
    if (input.right) { this.vx =  speed; this.facingRight = true; }

    // Jump
    if (input.jump && this.onGround) {
      this.vy = CFG.JUMP_FORCE;
      this.onGround = false;
    }
    input.jump = false; // consume

    this.applyGravity();
    this.move();
    Physics.resolveCollision(this, platforms);

    // Clamp to world
    if (this.x < 0) this.x = 0;
    if (this.x + this.w > CFG.WORLD_W) this.x = CFG.WORLD_W - this.w;

    // Stress ticks up slowly over time
    if (this.frame % 480 === 0 && this.stats.stress < 90) this.stats.stress += 1;
    // Finances drain very slowly
    if (this.frame % 1800 === 0 && this.stats.finances > 0) this.stats.finances -= 20;
    // Tick extStats evolution
    StatsSystem.tick(this.extStats, this.frame);

    this.animTimer++;
    if (this.animTimer > 8) { this.animFrame = (this.animFrame + 1) % 4; this.animTimer = 0; }
  }

  draw(ctx, camX) {
    const px = Math.round(this.x - camX);
    const py = Math.round(this.y);
    ctx.save();

    // Flicker when invincible
    if (this.invincible > 0 && Math.floor(this.invincible / 4) % 2 === 0) {
      ctx.restore(); return;
    }

    // Body
    ctx.fillStyle = '#2d5a27'; // dark green (military uniform)
    ctx.fillRect(px, py + 8, this.w, this.h - 8);

    // Head
    ctx.fillStyle = '#f0c080';
    ctx.fillRect(px + 4, py, this.w - 8, 16);

    // Beret
    ctx.fillStyle = '#1a3a1a';
    ctx.fillRect(px + 2, py - 4, this.w - 4, 8);

    // Eyes
    ctx.fillStyle = '#222';
    const eyeDir = this.facingRight ? 1 : -1;
    ctx.fillRect(px + (this.facingRight ? 14 : 6), py + 4, 3, 3);

    // Stress indicator (red tint if high stress)
    if (this.stats.stress > 65) {
      ctx.fillStyle = 'rgba(255,0,0,0.22)';
      ctx.fillRect(px, py, this.w, this.h);
    }

    // Slow indicator
    if (this.slowTimer > 0) {
      ctx.fillStyle = 'rgba(150,100,255,0.3)';
      ctx.fillRect(px, py, this.w, this.h);
    }

    ctx.restore();
  }
}

class Enemy extends Entity {
  constructor(x, patrolMin, patrolMax, type) {
    super(x, CFG.GROUND_Y - 40, 30, 40);
    this.patrolMin = patrolMin;
    this.patrolMax = patrolMax;
    this.type = type;       // 0=Bureaucrat,1=Scammer,2=BadEmployer,3=TaxAgent
    this.state = 'patrol';  // patrol | chase | attack | stunned
    this.dir = 1;
    this.stunTimer = 0;
    this.attackTimer = 0;
    this.projectiles = [];
    const baseSpeed = type === 3 ? CFG.ENEMY_PATROL_SPEED * 1.6 : CFG.ENEMY_PATROL_SPEED;
    this.speed = baseSpeed;
    this.chaseSpeed = type === 3 ? CFG.ENEMY_CHASE_SPEED * 1.4 : CFG.ENEMY_CHASE_SPEED;
  }

  update(player, platforms) {
    this.frame++;
    if (this.stunTimer > 0) { this.stunTimer--; return; }

    const dist = player.x - this.x;
    const absDist = Math.abs(dist);

    // State machine
    if (this.type === 2) {
      // Bad employer stays put but throws projectiles
      this.state = 'attack';
      this.attackTimer++;
      if (this.attackTimer > 120 && absDist < 400) {
        this.attackTimer = 0;
        const dir = dist > 0 ? 1 : -1;
        this.projectiles.push({
          x: this.x + this.w / 2, y: this.y + 10,
          vx: dir * CFG.PROJECTILE_SPEED + dir * 1.5, vy: -2,
          alive: true,
        });
      }
    } else {
      if (absDist < CFG.ENEMY_DETECT_RANGE && player.stats.health > 0) {
        this.state = 'chase';
        this.vx = dist > 0 ? this.chaseSpeed : -this.chaseSpeed;
      } else {
        this.state = 'patrol';
        this.x += this.dir * this.speed;
        if (this.x < this.patrolMin) { this.dir = 1; this.x = this.patrolMin; }
        if (this.x > this.patrolMax) { this.dir = -1; this.x = this.patrolMax; }
        this.vx = 0;
      }
    }

    if (this.state === 'chase') {
      this.x += this.vx;
      if (this.x < 0) this.x = 0;
      if (this.x + this.w > CFG.WORLD_W) this.x = CFG.WORLD_W - this.w;
    }

    // Update projectiles
    for (const pr of this.projectiles) {
      if (!pr.alive) continue;
      pr.x += pr.vx; pr.y += pr.vy; pr.vy += 0.15;
      if (pr.x < 0 || pr.x > CFG.WORLD_W || pr.y > CFG.GROUND_Y) pr.alive = false;
    }
    this.projectiles = this.projectiles.filter(p => p.alive);
  }

  draw(ctx, camX) {
    if (!this.alive) return;
    const px = Math.round(this.x - camX);
    const py = Math.round(this.y);
    const colors = ['#8b4513','#2e4057','#c0392b','#7f8c8d'];
    const icons  = ['üëî','üé≠','üò°','üìã'];
    ctx.save();
    ctx.fillStyle = colors[this.type] || '#888';
    ctx.fillRect(px, py + 8, this.w, this.h - 8);
    ctx.fillStyle = '#f0c080';
    ctx.fillRect(px + 4, py, this.w - 8, 14);
    ctx.font = '14px serif';
    ctx.textAlign = 'center';
    ctx.fillText(icons[this.type] || '?', px + this.w / 2, py + 12);
    // Stunned flash
    if (this.stunTimer > 0) {
      ctx.fillStyle = 'rgba(255,255,0,0.35)';
      ctx.fillRect(px, py, this.w, this.h);
    }
    ctx.restore();

    // Draw projectiles
    for (const pr of this.projectiles) {
      ctx.fillStyle = '#e8e0d0';
      ctx.fillRect(Math.round(pr.x - camX) - 4, Math.round(pr.y) - 3, 12, 8);
      ctx.font = '10px serif';
      ctx.textAlign = 'center';
      ctx.fillText('üìÑ', Math.round(pr.x - camX), Math.round(pr.y));
    }
  }
}

class NPC extends Entity {
  constructor(x, type, name) {
    super(x, CFG.GROUND_Y - 42, 28, 42);
    this.type = type; // 0=veteran, 1=hr, 2=instructor
    this.name = name;
    this.talked = false;
    this.bobTimer = 0;
  }
  update() { this.bobTimer++; }
  draw(ctx, camX) {
    const px = Math.round(this.x - camX);
    const py = Math.round(this.y + Math.sin(this.bobTimer * 0.04) * 2);
    const colors = ['#2d5a27','#1a5f7a','#7a5c1a','#4a1a5a'];
    const faceIcons = ['üßë‚Äç‚úàÔ∏è','üë©‚Äçüíº','üë®‚Äçüè´','‚öñÔ∏è'];
    ctx.save();
    ctx.fillStyle = colors[this.type] || '#666';
    ctx.fillRect(px, py + 10, this.w, this.h - 10);
    ctx.fillStyle = '#f0c080';
    ctx.fillRect(px + 3, py, this.w - 6, 16);
    ctx.font = '16px serif';
    ctx.textAlign = 'center';
    ctx.fillText(faceIcons[this.type] || 'üòä', px + this.w / 2, py + 14);
    // Interaction hint
    ctx.fillStyle = '#00a67e';
    ctx.font = 'bold 11px sans-serif';
    ctx.fillText('[E]', px + this.w / 2, py - 8);
    if (!this.talked) {
      // Pulsing indicator
      const alpha = 0.5 + 0.5 * Math.sin(this.bobTimer * 0.08);
      ctx.fillStyle = `rgba(0,166,126,${alpha})`;
      ctx.beginPath();
      ctx.arc(px + this.w / 2, py - 16, 5, 0, Math.PI * 2);
      ctx.fill();
    }
    ctx.restore();
  }
}

class Building {
  constructor(x, y, w, h, type, name) {
    this.x = x; this.y = y; this.w = w; this.h = h;
    this.type = type; // 0=IT, 1=Factory, 2=Startup
    this.name = name;
    this.interviewDone = false;
    this.jobOffered = false;
    this.frame = 0;
  }
  get doorX() { return this.x + this.w / 2 - 16; }
  get doorY() { return this.y + this.h - 50; }

  isNearDoor(player) {
    return Math.abs(player.x + player.w / 2 - (this.doorX + 16)) < 55 &&
           player.y + player.h > this.y + this.h - 80;
  }

  draw(ctx, camX) {
    this.frame++;
    const bx = Math.round(this.x - camX);
    const by = Math.round(this.y);

    // Building colors by type
    const wallColors   = ['#1a2a4a','#2a2a2a','#3a2010'];
    const accentColors = ['#2563eb','#6b7280','#f97316'];
    const typeLabels   = ['IT','üè≠','üöÄ'];

    ctx.save();

    // Main structure
    ctx.fillStyle = wallColors[this.type] || '#333';
    ctx.fillRect(bx, by, this.w, this.h);

    // Roof / top trim
    ctx.fillStyle = accentColors[this.type] || '#555';
    ctx.fillRect(bx - 4, by - 6, this.w + 8, 10);

    // Windows (2 rows √ó 3 columns)
    ctx.fillStyle = 'rgba(255,255,180,0.85)';
    for (let row = 0; row < 2; row++) {
      for (let col = 0; col < 3; col++) {
        const wx = bx + 16 + col * ((this.w - 32) / 3);
        const wy = by + 18 + row * 45;
        ctx.fillRect(wx, wy, 24, 18);
        // Window light flicker on IT buildings
        if (this.type === 0 && Math.sin(this.frame * 0.03 + row + col) > 0.5) {
          ctx.fillStyle = 'rgba(100,200,255,0.4)';
          ctx.fillRect(wx, wy, 24, 18);
          ctx.fillStyle = 'rgba(255,255,180,0.85)';
        }
      }
    }

    // Door
    ctx.fillStyle = '#8B6914';
    ctx.fillRect(Math.round(this.doorX - camX), Math.round(this.doorY), 32, 44);
    ctx.fillStyle = accentColors[this.type];
    ctx.fillRect(Math.round(this.doorX - camX) + 4, Math.round(this.doorY) + 4, 10, 36);

    // Sign / name
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 11px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(this.name, bx + this.w / 2, by + 14);

    // Type badge
    ctx.fillStyle = accentColors[this.type];
    ctx.fillRect(bx + this.w - 28, by - 4, 24, 16);
    ctx.fillStyle = '#fff';
    ctx.font = '10px sans-serif';
    ctx.fillText(typeLabels[this.type] || '?', bx + this.w - 16, by + 8);

    // Interact hint
    if (this.isNearDoor({ x: 0 - 9999, y: 0, w: 0, h: 0 }) === false) {
      // only drawn dynamically in main drawUI
    }

    // Job offered flag
    if (this.jobOffered) {
      ctx.fillStyle = '#00a67e';
      ctx.font = 'bold 12px sans-serif';
      ctx.fillText('‚úÖ –û—Ñ–µ—Ä!', bx + this.w / 2, by - 14);
    } else if (this.interviewDone) {
      ctx.fillStyle = '#e74c3c';
      ctx.font = '11px sans-serif';
      ctx.fillText('‚úó –í—ñ–¥–º–æ–≤–∞', bx + this.w / 2, by - 14);
    }

    ctx.restore();
  }
}

class Collectible {
  constructor(x, y, type) {
    this.x = x; this.y = y; this.type = type;
    this.w = 22; this.h = 22;
    this.collected = false;
    this.bobTimer = Math.random() * Math.PI * 2;
  }
  get icons()  { return ['üìö','üèÜ','üìù','üí∞','üíä','üáµüá±','üá¨üáß','üéñÔ∏è','ü™™']; }
  get labels() { return ['+INT','+REP','+CHR','+PLN','+HP','+PL','+EN','+MIL','+DOC']; }
  draw(ctx, camX) {
    if (this.collected) return;
    this.bobTimer += 0.06;
    const px = Math.round(this.x - camX);
    const py = Math.round(this.y + Math.sin(this.bobTimer) * 3);
    ctx.font = '20px serif';
    ctx.textAlign = 'center';
    ctx.fillText(this.icons[this.type] || '‚≠ê', px + 11, py + 18);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 8px sans-serif';
    ctx.fillText(this.labels[this.type] || '+?', px + 11, py + 28);
  }
  apply(stats, extStats) {
    const map = [
      () => { stats.intelligence = Math.min(100, stats.intelligence + 5); stats.civilExp += 3; stats.luck = Math.min(100, stats.luck + 1); },
      () => { stats.reputation   = Math.min(100, stats.reputation + 8); stats.documents = Math.min(100, stats.documents + 3); },
      () => { stats.charisma     = Math.min(100, stats.charisma + 6); },
      () => { stats.finances     += 300; },
      () => { stats.stress       = Math.max(0, stats.stress - 15); stats.health = Math.min(100, stats.health + 20); stats.luck = Math.min(100, stats.luck + 2); },
      () => { stats.polishLang   = Math.min(100, stats.polishLang + 10); stats.documents = Math.min(100, stats.documents + 5); },
      () => { stats.englishLang  = Math.min(100, stats.englishLang + 8); },
      () => { stats.militaryExp  = Math.min(100, stats.militaryExp + 8); stats.luck = Math.min(100, stats.luck + 6); stats.reputation = Math.min(100, stats.reputation + 4); },
      () => { stats.documents    = Math.min(100, stats.documents + 15); stats.reputation = Math.min(100, stats.reputation + 5); stats.stress = Math.max(0, stats.stress - 8); },
    ];
    if (map[this.type]) map[this.type]();
    // Also update extStats sub-parameters
    StatsSystem.applyCollectible(extStats, this.type);
  }
}

// ============================================================
// MODULE: QuestSystem
// ============================================================
const QuestSystem = {
  init() {
    return DATA.quests.map(q => ({ ...q, progress: 0, done: false }));
  },
  update(quests, game) {
    const p = game.player;
    for (const q of quests) {
      if (q.done) continue;
      switch (q.type) {
        case 'collect':    q.progress = game.collected; break;
        case 'polishLang': q.progress = p.stats.polishLang; break;
        case 'portfolio':
          q.progress = (game.hasCert ? 1 : 0) + (game.hasRec ? 1 : 0) + (p.stats.finances >= 1500 ? 1 : 0);
          break;
        case 'interview':  q.progress = game.interviewsDone; break;
        case 'veterans':   q.progress = game.veteransMet; break;
        case 'business':
          q.progress = (p.stats.finances >= 5000 && p.stats.reputation >= 70) ? 1 : 0;
          break;
        case 'documents':  q.progress = p.stats.documents || 0; break;
        case 'luck':       q.progress = p.stats.luck || 0; break;
      }
      if (q.progress >= q.target && !q.done) {
        q.done = true;
        game.onQuestComplete(q);
      }
    }
  },
};

// ============================================================
// MODULE: UISystem ‚Äî HUD, dialogue box, overlays
// ============================================================
const UISystem = {
  drawBar(ctx, x, y, w, h, value, max, color, label) {
    ctx.fillStyle = 'rgba(0,0,0,0.55)';
    ctx.fillRect(x - 1, y - 1, w + 2, h + 2);
    ctx.fillStyle = '#333';
    ctx.fillRect(x, y, w, h);
    const filled = Math.max(0, Math.min(w, (value / max) * w));
    ctx.fillStyle = color;
    ctx.fillRect(x, y, filled, h);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 9px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(label, x + 3, y + h - 2);
  },

  drawHUD(ctx, player, camX, economySystem, questsDone, frame) {
    const s = player.stats;
    ctx.save();

    // Semi-transparent HUD panel
    ctx.fillStyle = 'rgba(5,10,20,0.78)';
    ctx.fillRect(0, 0, CFG.CANVAS_W, 70);

    // Health bar
    UISystem.drawBar(ctx, 8,  6, 80, 10, s.health,      100, '#e74c3c', `‚ù§ ${s.health}`);
    // Stress bar (lower = better, shown as inverted)
    UISystem.drawBar(ctx, 98, 6, 70, 10, 100 - s.stress, 100, '#f39c12', `üòå ${100-s.stress}%`);
    // Mental health bar
    UISystem.drawBar(ctx, 8, 20, 80, 10, s.mentalHealth, 100, '#9b59b6', `üß† ${s.mentalHealth}`);
    // Polish language bar
    UISystem.drawBar(ctx, 98, 20, 70, 10, s.polishLang,  100, '#1a8cff', `üáµüá± ${s.polishLang}%`);
    // Luck bar
    UISystem.drawBar(ctx, 8,  34, 80, 10, s.luck || 0,   100, '#f0c040', `üçÄ ${s.luck || 0}`);
    // Documents bar
    UISystem.drawBar(ctx, 98, 34, 70, 10, s.documents || 0, 100, '#20c090', `üìÑ ${s.documents || 0}%`);

    // Finances
    ctx.fillStyle = '#00e5a0';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(`üí∞ ${s.finances.toLocaleString('pl-PL')} PLN`, 182, 18);

    // Reputation
    ctx.fillStyle = '#ffd700';
    ctx.fillText(`‚≠ê –†–µ–ø: ${s.reputation}`, 182, 34);

    // Stats summary (right side)
    ctx.fillStyle = 'rgba(255,255,255,0.8)';
    ctx.font = '10px sans-serif';
    ctx.textAlign = 'right';
    ctx.fillText(`INT:${s.intelligence} STR:${s.strength} CHR:${s.charisma} EN:${s.englishLang}`, CFG.CANVAS_W - 8, 16);
    ctx.fillText(`MilXP:${s.militaryExp} CivXP:${s.civilExp} Quests:${questsDone}`, CFG.CANVAS_W - 8, 30);
    ctx.fillText(`–£–¥–∞—á–∞:${s.luck || 0} –î–æ–∫—É–º–µ–Ω—Ç–∏:${s.documents || 0}`, CFG.CANVAS_W - 8, 44);

    // Extended stats highlights (top right, compact)
    const ext = player.extStats;
    if (ext) {
      ctx.fillStyle = 'rgba(0,229,160,0.75)';
      ctx.font = '9px sans-serif';
      const highlights = StatsSystem.getTopHighlights(ext);
      if (highlights) ctx.fillText(highlights, CFG.CANVAS_W - 8, 56);
    }

    // Economy demand indicators
    ctx.font = '9px sans-serif';
    ctx.textAlign = 'right';
    ctx.fillStyle = '#aaa';
    ctx.fillText(`IT:${Math.round(economySystem.getDemand(0))}% üè≠:${Math.round(economySystem.getDemand(1))}% üöÄ:${Math.round(economySystem.getDemand(2))}%`, CFG.CANVAS_W - 8, 66);

    // Quests shortcut hint
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '9px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText('[Q] –∫–≤–µ—Å—Ç–∏  [ESC] –ø–∞—É–∑–∞  [S] –∑–±–µ—Ä–µ–≥—Ç–∏', 8, 58);

    ctx.restore();
  },

  drawDialogueBox(ctx, dialogue) {
    if (!dialogue.visible) return;
    ctx.save();
    const bx = 30, by = CFG.CANVAS_H - 185, bw = CFG.CANVAS_W - 60, bh = 175;

    // Box
    ctx.fillStyle = 'rgba(5,15,30,0.94)';
    ctx.beginPath();
    ctx.roundRect ? ctx.roundRect(bx, by, bw, bh, 12) : ctx.rect(bx, by, bw, bh);
    ctx.fill();
    ctx.strokeStyle = '#00a67e';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.roundRect ? ctx.roundRect(bx, by, bw, bh, 12) : ctx.rect(bx, by, bw, bh);
    ctx.stroke();

    // Speaker
    ctx.fillStyle = '#00e5a0';
    ctx.font = 'bold 13px sans-serif';
    ctx.textAlign = 'left';
    ctx.fillText(dialogue.speaker || 'NPC', bx + 12, by + 20);

    // Message text (word wrap)
    ctx.fillStyle = '#e8f4f8';
    ctx.font = '13px sans-serif';
    const maxWidth = bw - 24;
    const lineH = 19;
    const words = (dialogue.text || '').split(' ');
    let line = '', lineY = by + 42;
    for (let i = 0; i < words.length; i++) {
      const testLine = line + words[i] + ' ';
      if (ctx.measureText(testLine).width > maxWidth && i > 0) {
        ctx.fillText(line, bx + 12, lineY);
        line = words[i] + ' ';
        lineY += lineH;
        if (lineY > by + bh - 55) { ctx.fillText('...', bx + 12, lineY); break; }
      } else { line = testLine; }
    }
    ctx.fillText(line, bx + 12, lineY);

    // Options
    if (dialogue.options && dialogue.options.length) {
      dialogue.options.forEach((opt, i) => {
        const oy = by + bh - 48 + i * 24;
        const active = dialogue.selectedOption === i;
        ctx.fillStyle = active ? '#00a67e' : 'rgba(255,255,255,0.15)';
        ctx.fillRect(bx + 10, oy - 15, bw - 20, 20);
        ctx.fillStyle = active ? '#fff' : '#aaa';
        ctx.font = `${active ? 'bold ' : ''}12px sans-serif`;
        ctx.fillText(`${i === 0 ? '[A]' : '[B]'} ${opt}`, bx + 18, oy);
      });
    } else {
      ctx.fillStyle = 'rgba(255,255,255,0.45)';
      ctx.font = '11px sans-serif';
      ctx.textAlign = 'right';
      ctx.fillText('[E / Enter] –∞–±–æ üëÜ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏', bx + bw - 10, by + bh - 8);
    }

    ctx.restore();
  },

  drawQuestLog(ctx, quests, visible, extStats) {
    if (!visible) return;
    ctx.save();
    const qx = CFG.CANVAS_W - 290, qy = 58, qw = 282, qh = 225;
    ctx.fillStyle = 'rgba(5,15,30,0.92)';
    ctx.fillRect(qx, qy, qw, qh);
    ctx.strokeStyle = '#ffd700';
    ctx.lineWidth = 1.5;
    ctx.strokeRect(qx, qy, qw, qh);

    ctx.fillStyle = '#ffd700';
    ctx.font = 'bold 12px sans-serif';
    ctx.textAlign = 'left';
    const extCount = StatsSystem.count(extStats);
    ctx.fillText(`üìã –ö–≤–µ—Å—Ç–∏  [${extCount}+ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤]`, qx + 8, qy + 16);

    quests.forEach((q, i) => {
      const ly = qy + 30 + i * 28;
      ctx.fillStyle = q.done ? '#00e5a0' : '#ccc';
      ctx.font = `${q.done ? 'bold ' : ''}11px sans-serif`;
      const pct = q.target > 0 ? Math.min(q.progress, q.target) : q.progress;
      ctx.fillText(`${q.done ? '‚úÖ' : '‚óã'} ${q.name}`, qx + 8, ly);
      ctx.fillStyle = '#888';
      ctx.font = '10px sans-serif';
      ctx.fillText(`  ${q.desc} (${pct}/${q.target})`, qx + 10, ly + 13);
    });
    ctx.restore();
  },

  drawPauseMenu(ctx, visible) {
    if (!visible) return;
    ctx.save();
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0, 0, CFG.CANVAS_W, CFG.CANVAS_H);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 32px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('‚è∏ –ü–ê–£–ó–ê', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 - 30);
    ctx.font = '18px sans-serif';
    ctx.fillText('[ESC] –∞–±–æ –∫–Ω–æ–ø–∫–∞ ‚è∏ ‚Äî –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –≥—Ä—É', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 + 10);
    ctx.fillText('[S] ‚Äî –∑–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 + 40);
    ctx.fillText('[R] ‚Äî –Ω–æ–≤–∞ –≥—Ä–∞', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 + 70);
    ctx.fillStyle = 'rgba(255,255,255,0.45)';
    ctx.font = '14px sans-serif';
    ctx.fillText('üëÜ –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –µ–∫—Ä–∞–Ω–∞ —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 + 110);
    ctx.restore();
  },

  drawStartScreen(ctx) {
    ctx.save();
    // Sky gradient
    const grad = ctx.createLinearGradient(0, 0, 0, CFG.CANVAS_H);
    grad.addColorStop(0, '#0a0a1a');
    grad.addColorStop(1, '#1a2a3a');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, CFG.CANVAS_W, CFG.CANVAS_H);

    // Stars
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    const stars = [[120,80],[250,40],[400,90],[560,55],[700,75],[820,40],[900,90],[100,150],[300,120],[650,130],[800,110]];
    for (const [sx, sy] of stars) { ctx.fillRect(sx, sy, 2, 2); }

    ctx.fillStyle = '#fff';
    ctx.font = 'bold 36px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('üéñÔ∏è –®–ª—è—Ö –í–µ—Ç–µ—Ä–∞–Ω–∞', CFG.CANVAS_W / 2, 130);

    ctx.fillStyle = '#00e5a0';
    ctx.font = '16px sans-serif';
    ctx.fillText('–ü–æ—à—É–∫ —Ä–æ–±–æ—Ç–∏ —É –ü–æ–ª—å—â—ñ –ø—ñ—Å–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ —Ñ—Ä–æ–Ω—Ç—É', CFG.CANVAS_W / 2, 170);

    ctx.fillStyle = 'rgba(255,255,255,0.8)';
    ctx.font = '14px sans-serif';
    ctx.fillText('‚Üê ‚Üí —Ä—É—Ö  |  ‚Üë / –ü—Ä–æ–±—ñ–ª —Å—Ç—Ä–∏–±–æ–∫  |  E ‚Äî –≤–∑–∞—î–º–æ–¥—ñ—è', CFG.CANVAS_W / 2, 230);

    ctx.fillStyle = '#ffd700';
    ctx.font = 'bold 20px sans-serif';
    ctx.fillText('–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –ü–†–û–ë–Ü–õ –∞–±–æ —Ç–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –µ–∫—Ä–∞–Ω–∞', CFG.CANVAS_W / 2, 285);
    ctx.font = '16px sans-serif';
    ctx.fillStyle = 'rgba(255,215,0,0.8)';
    ctx.fillText('—â–æ–± –ø–æ—á–∞—Ç–∏ –≥—Ä—É', CFG.CANVAS_W / 2, 310);

    const hasSave = !!SaveSystem.load();
    if (hasSave) {
      ctx.fillStyle = '#00a67e';
      ctx.font = '14px sans-serif';
      ctx.fillText('–∞–±–æ [L] —â–æ–± –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', CFG.CANVAS_W / 2, 320);
    }

    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '12px sans-serif';
    ctx.fillText('–¶—ñ–ª—å: –∑–Ω–∞–π–¥—ñ—Ç—å —Ä–æ–±–æ—Ç—É, –≤–∏–∫–æ–Ω–∞–π—Ç–µ –∫–≤–µ—Å—Ç–∏, —É–Ω–∏–∫–∞–π—Ç–µ –≤–æ—Ä–æ–≥—ñ–≤', CFG.CANVAS_W / 2, 380);
    ctx.fillText('3 —Ç–∏–ø–∏ –±—É–¥—ñ–≤–µ–ª—å ¬∑ 4 —Ç–∏–ø–∏ –≤–æ—Ä–æ–≥—ñ–≤ ¬∑ 6 –∫–≤–µ—Å—Ç—ñ–≤ ¬∑ 6 –∫—ñ–Ω—Ü—ñ–≤–æ–∫', CFG.CANVAS_W / 2, 400);

    ctx.restore();
  },

  drawEndingScreen(ctx, ending) {
    if (!ending) return;
    ctx.save();
    const isGood = ending.id !== 'bad';
    ctx.fillStyle = isGood ? 'rgba(0,30,15,0.95)' : 'rgba(20,5,5,0.95)';
    ctx.fillRect(0, 0, CFG.CANVAS_W, CFG.CANVAS_H);

    ctx.font = '64px serif';
    ctx.textAlign = 'center';
    ctx.fillText(ending.icon, CFG.CANVAS_W / 2, 120);

    ctx.fillStyle = '#ffd700';
    ctx.font = 'bold 28px sans-serif';
    ctx.fillText(ending.title, CFG.CANVAS_W / 2, 170);

    ctx.fillStyle = '#e8f4f8';
    ctx.font = '15px sans-serif';
    const lines = ending.text.split(' ').reduce((acc, w) => {
      const last = acc[acc.length - 1];
      if (last && last.length + w.length < 60) { acc[acc.length - 1] += ' ' + w; }
      else acc.push(w);
      return acc;
    }, []);
    lines.forEach((ln, i) => ctx.fillText(ln, CFG.CANVAS_W / 2, 210 + i * 28));

    ctx.fillStyle = '#00a67e';
    ctx.font = 'bold 18px sans-serif';
    ctx.fillText('[R] ‚Äî –ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É  |  üëÜ –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è —â–æ–± –ø–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É', CFG.CANVAS_W / 2, CFG.CANVAS_H - 50);
    ctx.restore();
  },

  drawNotification(ctx, notif) {
    if (!notif || !notif.visible) return;
    ctx.save();
    const alpha = Math.min(1, notif.timer / 30) * Math.min(1, (notif.maxTimer - notif.timer) / 30);
    ctx.fillStyle = `rgba(0,166,126,${0.92 * alpha})`;
    ctx.fillRect(CFG.CANVAS_W / 2 - 200, 58, 400, 36);
    ctx.fillStyle = `rgba(255,255,255,${alpha})`;
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(notif.text, CFG.CANVAS_W / 2, 82);
    ctx.restore();
  },

  drawMoralChoice(ctx, mc) {
    if (!mc || !mc.visible) return;
    ctx.save();
    ctx.fillStyle = 'rgba(5,15,30,0.96)';
    ctx.fillRect(50, CFG.CANVAS_H / 2 - 90, CFG.CANVAS_W - 100, 180);
    ctx.strokeStyle = '#f39c12';
    ctx.lineWidth = 2;
    ctx.strokeRect(50, CFG.CANVAS_H / 2 - 90, CFG.CANVAS_W - 100, 180);

    ctx.fillStyle = '#f39c12';
    ctx.font = 'bold 14px sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('‚öñÔ∏è –ú–æ—Ä–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 - 68);

    ctx.fillStyle = '#fff';
    ctx.font = '14px sans-serif';
    ctx.fillText(mc.text, CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 - 40);

    const aActive = mc.selected === 0;
    ctx.fillStyle = aActive ? '#f39c12' : 'rgba(255,255,255,0.15)';
    ctx.fillRect(80, CFG.CANVAS_H / 2 - 15, (CFG.CANVAS_W - 180) / 2, 28);
    ctx.fillStyle = aActive ? '#000' : '#ccc';
    ctx.font = `${aActive ? 'bold ' : ''}12px sans-serif`;
    ctx.textAlign = 'center';
    ctx.fillText(`[A] ${mc.optA}`, CFG.CANVAS_W / 2 - (CFG.CANVAS_W - 180) / 4 - 10, CFG.CANVAS_H / 2 + 4);

    const bActive = mc.selected === 1;
    ctx.fillStyle = bActive ? '#00a67e' : 'rgba(255,255,255,0.15)';
    ctx.fillRect(CFG.CANVAS_W / 2 + 10, CFG.CANVAS_H / 2 - 15, (CFG.CANVAS_W - 180) / 2, 28);
    ctx.fillStyle = bActive ? '#000' : '#ccc';
    ctx.font = `${bActive ? 'bold ' : ''}12px sans-serif`;
    ctx.fillText(`[B] ${mc.optB}`, CFG.CANVAS_W / 2 + (CFG.CANVAS_W - 180) / 4 + 10, CFG.CANVAS_H / 2 + 4);

    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '11px sans-serif';
    ctx.fillText('[A] / üëà –ª—ñ–≤–æ—Ä—É—á  |  [B] / üëâ –ø—Ä–∞–≤–æ—Ä—É—á', CFG.CANVAS_W / 2, CFG.CANVAS_H / 2 + 45);
    ctx.restore();
  },

  drawWorld(ctx, camX) {
    // Sky gradient
    const skyGrad = ctx.createLinearGradient(0, 0, 0, CFG.CANVAS_H);
    skyGrad.addColorStop(0, '#0d1117');
    skyGrad.addColorStop(0.65, '#1a2a4a');
    skyGrad.addColorStop(1, '#2a3a5a');
    ctx.fillStyle = skyGrad;
    ctx.fillRect(0, 0, CFG.CANVAS_W, CFG.CANVAS_H);

    // Static stars (seeded pattern)
    ctx.fillStyle = 'rgba(255,255,255,0.6)';
    for (let i = 0; i < 80; i++) {
      const sx = (i * 113 + 7) % CFG.CANVAS_W;
      const sy = (i * 79 + 11) % (CFG.CANVAS_H * 0.55);
      ctx.fillRect(sx, sy, 1.5, 1.5);
    }

    // Distant city silhouettes (parallax)
    const px2 = camX * 0.2;
    ctx.fillStyle = '#1a2030';
    for (let i = 0; i < 20; i++) {
      const bx2 = (i * 380 - px2 % 380 + 380) % (CFG.CANVAS_W + 200) - 100;
      const bh2 = 80 + (i * 37) % 100;
      ctx.fillRect(bx2, CFG.GROUND_Y - bh2, 60 + (i * 23) % 80, bh2);
    }

    // Ground
    ctx.fillStyle = '#1a2e0f';
    ctx.fillRect(0, CFG.GROUND_Y, CFG.CANVAS_W, CFG.CANVAS_H - CFG.GROUND_Y);
    ctx.fillStyle = '#2d4a1a';
    ctx.fillRect(0, CFG.GROUND_Y, CFG.CANVAS_W, 6);
  },

  drawPlatforms(ctx, platforms, camX) {
    for (const p of platforms) {
      const [px, py, pw, ph] = p;
      const sx = px - camX;
      if (sx + pw < 0 || sx > CFG.CANVAS_W) continue;
      if (py >= CFG.GROUND_Y) {
        // Ground ‚Äî already drawn
        continue;
      }
      ctx.fillStyle = '#3a5a25';
      ctx.fillRect(Math.round(sx), Math.round(py), pw, ph);
      ctx.fillStyle = '#4a7a30';
      ctx.fillRect(Math.round(sx), Math.round(py), pw, 4);
    }
  },
};

// ============================================================
// MODULE: GameEngine ‚Äî the main game orchestrator
// ============================================================
class GameEngine {
  constructor(canvas) {
    this.canvas = canvas;
    this.ctx = canvas.getContext('2d');
    this.state = 'start'; // start | playing | paused | dialogue | moralChoice | ending
    this.frame = 0;
    this.camX = 0;
    this.camXTarget = 0;
    this.lastSave = Date.now();

    // Input state
    this.input = {
      left: false, right: false, jump: false,
      interact: false, questLog: false, save: false, restart: false,
      keyA: false, keyB: false,
    };

    // Game entities
    this.player = null;
    this.buildings = [];
    this.collectibles = [];
    this.enemies = [];
    this.npcs = [];
    this.platforms = [];

    // Progress tracking
    this.collected = 0;
    this.hasCert = false;
    this.hasRec = false;
    this.interviewsDone = 0;
    this.veteransMet = 0;
    this.moralChoicesDone = 0;
    this.quests = [];
    this.questsDone = 0;
    this.ending = null;

    // UI state
    this.dialogue = { visible: false, speaker: '', text: '', options: [], selectedOption: 0, callback: null };
    this.questLogVisible = false;
    this.notification = { visible: false, text: '', timer: 0, maxTimer: 150 };
    this.moralChoice = null;

    this._bindInput();
    this._initWorld();
  }

  _bindInput() {
    const keyMap = {
      'ArrowLeft': 'left', 'KeyA': 'left',
      'ArrowRight': 'right', 'KeyD': 'right',
      'ArrowUp': 'jump', 'KeyW': 'jump', 'Space': 'jump',
      'KeyE': 'interact', 'Enter': 'interact',
      'KeyQ': 'questLog',
      'KeyS': 'save',
      'KeyR': 'restart',
      'KeyA_moral': 'keyA',
      'KeyB': 'keyB',
      'KeyL': 'load',
    };

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') e.preventDefault();
      if (e.code === 'ArrowLeft' || e.code === 'ArrowRight' ||
          e.code === 'ArrowUp' || e.code === 'ArrowDown') e.preventDefault();

      if (e.code === 'Escape') { this._handleEscape(); return; }
      if (e.code === 'KeyR') { if (this.state === 'ending' || this.state === 'paused') this._initWorld(); return; }
      if (e.code === 'KeyL') { if (this.state === 'start') this._loadGame(); return; }
      if (e.code === 'KeyA') { this._handleMoralKeyA(); }
      if (e.code === 'KeyB') { this._handleMoralKeyB(); }

      const mapped = keyMap[e.code];
      if (mapped && mapped in this.input) this.input[mapped] = true;

      if (e.code === 'KeyQ' && this.state === 'playing') {
        this.questLogVisible = !this.questLogVisible;
        this.input.questLog = false;
      }
      if (e.code === 'KeyS' && this.state === 'playing') {
        this._saveGame();
        this.input.save = false;
      }
      if ((e.code === 'Space' || e.code === 'Enter') && this.state === 'start') {
        this.state = 'playing';
      }
      if ((e.code === 'KeyE' || e.code === 'Enter') && this.state === 'dialogue') {
        this._advanceDialogue();
      }
    });

    document.addEventListener('keyup', (e) => {
      const keyMap2 = {
        'ArrowLeft': 'left', 'KeyA': 'left',
        'ArrowRight': 'right', 'KeyD': 'right',
        'ArrowUp': 'jump', 'KeyW': 'jump', 'Space': 'jump',
      };
      const mapped = keyMap2[e.code];
      if (mapped && mapped in this.input) this.input[mapped] = false;
    });

    // Bind touch controls on touch-capable devices
    if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
      this._bindTouchControls();
    }
  }

  _bindTouchControls() {
    const overlay = document.getElementById('touch-controls');
    if (!overlay) return;
    overlay.classList.add('active');

    // Helper to create a button
    const mkBtn = (id, html) => {
      const btn = document.createElement('button');
      btn.id = id;
      btn.className = 'touch-btn';
      btn.innerHTML = html;
      overlay.appendChild(btn);
      return btn;
    };

    const btnLeft     = mkBtn('btn-left',     '‚óÄ');
    const btnRight    = mkBtn('btn-right',    '‚ñ∂');
    const btnJump     = mkBtn('btn-jump',     '‚Üë');
    const btnInteract = mkBtn('btn-interact', 'E');
    const btnQuest    = mkBtn('btn-quest',    'Q');
    const btnPause    = mkBtn('btn-pause',    '‚è∏');

    // D-pad: track each touch by identifier so multi-touch works
    const setKey = (key, val) => { this.input[key] = val; };

    const bindDpad = (btn, key) => {
      btn.addEventListener('touchstart', (e) => { e.preventDefault(); setKey(key, true); }, {passive: false});
      btn.addEventListener('touchend',   (e) => { e.preventDefault(); setKey(key, false); }, {passive: false});
      btn.addEventListener('touchcancel',(e) => { e.preventDefault(); setKey(key, false); }, {passive: false});
    };
    bindDpad(btnLeft,  'left');
    bindDpad(btnRight, 'right');

    btnJump.addEventListener('touchstart', (e) => { e.preventDefault(); this.input.jump = true; }, {passive: false});
    btnJump.addEventListener('touchend',   (e) => { e.preventDefault(); }, {passive: false});

    btnInteract.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (this.state === 'dialogue') {
        this._advanceDialogue();
      } else if (this.state === 'moralChoice') {
        this._handleMoralKeyA();
      } else {
        this.input.interact = true;
        setTimeout(() => { this.input.interact = false; }, 120);
      }
    }, {passive: false});

    btnQuest.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (this.state === 'playing') this.questLogVisible = !this.questLogVisible;
    }, {passive: false});

    btnPause.addEventListener('touchstart', (e) => {
      e.preventDefault();
      this._handleEscape();
    }, {passive: false});

    // Canvas tap handler for overlay states (start, dialogue, moral choice, ending, paused)
    this.canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touch = e.changedTouches[0];
      const rect = this.canvas.getBoundingClientRect();
      const scaleX = CFG.CANVAS_W / rect.width;
      const scaleY = CFG.CANVAS_H / rect.height;
      const cx = (touch.clientX - rect.left) * scaleX;
      const cy = (touch.clientY - rect.top) * scaleY;

      if (this.state === 'start') {
        this.state = 'playing';
      } else if (this.state === 'dialogue') {
        this._advanceDialogue();
      } else if (this.state === 'moralChoice') {
        // Left half ‚Üí choice A, right half ‚Üí choice B
        if (cx < CFG.CANVAS_W / 2) this._handleMoralKeyA();
        else this._handleMoralKeyB();
      } else if (this.state === 'ending') {
        this._initWorld();
      } else if (this.state === 'paused') {
        // Tap anywhere on paused canvas resumes
        this._handleEscape();
      }
    }, {passive: false});
  }

  _handleEscape() {
    if (this.state === 'playing') { this.state = 'paused'; }
    else if (this.state === 'paused') { this.state = 'playing'; }
    else if (this.state === 'dialogue') {
      this.dialogue.visible = false;
      this.state = 'playing';
    }
  }

  _handleMoralKeyA() {
    if (this.state !== 'moralChoice' || !this.moralChoice) return;
    DATA.moralChoices[this.moralChoice.idx].applyA(this.player);
    this.moralChoice = null;
    this.state = 'playing';
    this.moralChoicesDone++;
    this._notify('–í–∏ –ø—Ä–∏–π–Ω—è–ª–∏ —Ä—ñ—à–µ–Ω–Ω—è A');
  }

  _handleMoralKeyB() {
    if (this.state !== 'moralChoice' || !this.moralChoice) return;
    DATA.moralChoices[this.moralChoice.idx].applyB(this.player);
    this.moralChoice = null;
    this.state = 'playing';
    this.moralChoicesDone++;
    this._notify('–í–∏ –ø—Ä–∏–π–Ω—è–ª–∏ —Ä—ñ—à–µ–Ω–Ω—è B');
  }

  _advanceDialogue() {
    if (!this.dialogue.visible) return;
    if (this.dialogue.callback) {
      this.dialogue.callback();
      this.dialogue.callback = null;
    } else {
      this.dialogue.visible = false;
      this.state = 'playing';
    }
  }

  _initWorld(savedData) {
    this.player = new Player(120, CFG.GROUND_Y - CFG.PLAYER_H);
    this.platforms = DATA.platforms;
    this.buildings = DATA.buildings.map(b => new Building(...b));
    this.collectibles = DATA.collectibles.map(c => new Collectible(c.x, c.y, c.type));
    this.enemies = DATA.enemies.map(e => new Enemy(...e));
    this.npcs = DATA.npcs.map(n => new NPC(...n));
    this.collected = 0;
    this.hasCert = false;
    this.hasRec = false;
    this.interviewsDone = 0;
    this.veteransMet = 0;
    this.moralChoicesDone = 0;
    this.quests = QuestSystem.init();
    this.questsDone = 0;
    this.ending = null;
    this.camX = 0;
    this.dialogue = { visible: false, speaker: '', text: '', options: [], selectedOption: 0, callback: null };
    this.questLogVisible = false;
    this.notification = { visible: false, text: '', timer: 0, maxTimer: 150 };
    this.moralChoice = null;
    this.frame = 0;

    if (savedData) {
      Object.assign(this.player.stats, savedData.stats);
      // Restore extStats ‚Äî merge with defaults so new keys from updates are preserved
      if (savedData.extStats) Object.assign(this.player.extStats, savedData.extStats);
      this.player.x = savedData.x;
      this.quests = savedData.quests || this.quests;
      this.questsDone = savedData.questsDone ? savedData.questsDone.length : 0;
      this.collected = savedData.collected || 0;
      this.interviewsDone = savedData.interviewsDone || 0;
      this.veteransMet = savedData.veteransMet || 0;
      this.moralChoicesDone = savedData.moralChoicesDone || 0;
    }

    this.state = savedData ? 'playing' : (this.state === 'start' ? 'start' : 'playing');
    if (!savedData && this.state !== 'start') this.state = 'playing';
  }

  _saveGame() {
    const ok = SaveSystem.save({
      player: this.player,
      quests: this.quests,
      questsDone: this.quests.filter(q => q.done).map(q => q.id),
      collected: this.collected,
      interviewsDone: this.interviewsDone,
      veteransMet: this.veteransMet,
      moralChoicesDone: this.moralChoicesDone,
    });
    this._notify(ok ? 'üíæ –ü—Ä–æ–≥—Ä–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!' : '‚ö† –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
  }

  _loadGame() {
    const d = SaveSystem.load();
    if (d) { this._initWorld(d); this._notify('üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è!'); }
    else this._notify('–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
  }

  _notify(text, duration) {
    this.notification = { visible: true, text, timer: 0, maxTimer: duration || 150 };
  }

  onQuestComplete(quest) {
    this.questsDone++;
    this._notify(`‚úÖ –ö–≤–µ—Å—Ç –≤–∏–∫–æ–Ω–∞–Ω–æ: ${quest.name}!`, 200);
    this._saveGame();
    // Trigger moral choice occasionally after quest completion
    if (this.questsDone % 2 === 0 && this.moralChoicesDone < DATA.moralChoices.length) {
      setTimeout(() => {
        if (this.state === 'playing') {
          const mc = DATA.moralChoices[this.moralChoicesDone % DATA.moralChoices.length];
          this.moralChoice = { ...mc, idx: this.moralChoicesDone % DATA.moralChoices.length, visible: true };
          this.state = 'moralChoice';
        }
      }, 2000);
    }
  }

  _checkEnding() {
    const s = this.player.stats;
    if (s.finances <= 0) { this._triggerEnding('bad'); return; }
    if (s.finances >= 5000 && s.reputation >= 70) { this._triggerEnding('biz'); return; }
    if (this.veteransMet >= 3 && this.questsDone >= 5) { this._triggerEnding('vet'); return; }
    // Buildings trigger their own endings on job offer
  }

  _triggerEnding(id) {
    const e = DATA.endings.find(x => x.id === id);
    if (e && this.state !== 'ending') {
      this.ending = e;
      this.state = 'ending';
      SaveSystem.clear();
    }
  }

  _updateNotification() {
    if (!this.notification.visible) return;
    this.notification.timer++;
    if (this.notification.timer >= this.notification.maxTimer) {
      this.notification.visible = false;
    }
  }

  _checkCollectibles() {
    for (const c of this.collectibles) {
      if (c.collected) continue;
      if (Physics.rectOverlap(this.player.x, this.player.y, this.player.w, this.player.h,
                              c.x, c.y, c.w, c.h)) {
        c.collected = true;
        c.apply(this.player.stats, this.player.extStats);
        this.collected++;
        if (c.type === 1) this.hasCert = true;
        if (c.type === 2) this.hasRec = true;
        const labels = ['üìö +–Ü–Ω—Ç–µ–ª–µ–∫—Ç','üèÜ +–†–µ–ø—É—Ç–∞—Ü—ñ—è','üìù +–•–∞—Ä–∏–∑–º–∞','üí∞ +300 PLN','üíä -–°—Ç—Ä–µ—Å/+HP','üáµüá± +–ü–æ–ª—å—Å—å–∫–∞','üá¨üáß +–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞'];
        this._notify(labels[c.type] || '‚≠ê –ë–æ–Ω—É—Å!', 100);
      }
    }
  }

  _checkEnemyCollisions() {
    const p = this.player;
    if (p.invincible > 0) return;

    for (const e of this.enemies) {
      if (!e.alive) continue;

      // Check projectile collision
      for (const pr of e.projectiles) {
        if (pr.alive && Physics.rectOverlap(p.x, p.y, p.w, p.h, pr.x - 6, pr.y - 4, 12, 8)) {
          pr.alive = false;
          p.stats.health = Math.max(0, p.stats.health - 12);
          p.stats.stress = Math.min(100, p.stats.stress + 8);
          p.invincible = 60;
          this._notify('üò£ -12 HP ‚Äî –ø–∞–ø—ñ—Ä—Ü—ñ –≤—ñ–¥ –ø–æ–≥–∞–Ω–æ–≥–æ —Ä–æ–±–æ—Ç–æ–¥–∞–≤—Ü—è!', 80);
        }
      }

      if (!Physics.rectOverlap(p.x, p.y, p.w, p.h, e.x, e.y, e.w, e.h)) continue;

      p.invincible = 80;
      switch (e.type) {
        case 0: // Bureaucrat ‚Äî slow + stress
          p.slowTimer = 180;
          p.stats.stress = Math.min(100, p.stats.stress + 18);
          p.stats.mentalHealth = Math.max(0, p.stats.mentalHealth - 8);
          this._notify('üëî –ë—é—Ä–æ–∫—Ä–∞—Ç: –∑–∞—Ç—Ä–∏–º–∫–∞ —Ç–∞ —Å—Ç—Ä–µ—Å!', 90);
          break;
        case 1: // Scammer ‚Äî steal money
          const stolen = Math.min(p.stats.finances, 180 + Math.floor(Math.random() * 150));
          p.stats.finances -= stolen;
          p.stats.stress = Math.min(100, p.stats.stress + 12);
          this._notify(`üé≠ –®–∞—Ö—Ä–∞–π –≤–∫—Ä–∞–≤ ${stolen} PLN!`, 90);
          break;
        case 3: // Tax agent ‚Äî reduce stats
          p.stats.intelligence = Math.max(10, p.stats.intelligence - 4);
          p.stats.reputation = Math.max(0, p.stats.reputation - 6);
          this._notify('üìã –ü–æ–¥–∞—Ç–∫—ñ–≤–µ—Ü—å: -4 INT, -6 REP!', 90);
          break;
      }

      // Knockback
      p.vx = (p.x > e.x) ? 5 : -5;
      p.vy = -6;
    }
  }

  _checkBuildingInteraction() {
    if (!this.input.interact) return;
    this.input.interact = false;

    for (const b of this.buildings) {
      if (!b.isNearDoor(this.player)) continue;
      this._startInterview(b);
      return;
    }

    for (const npc of this.npcs) {
      if (Physics.rectOverlap(this.player.x, this.player.y - 20, this.player.w + 40, this.player.h + 30,
                              npc.x, npc.y, npc.w, npc.h)) {
        this._talkToNPC(npc);
        return;
      }
    }
  }

  _startInterview(building) {
    const s = this.player.stats;
    const ext = this.player.extStats;
    const typeNames = ['IT-–∫–æ–º–ø–∞–Ω—ñ—è', '–ó–∞–≤–æ–¥ / –°–∫–ª–∞–¥', '–°—Ç–∞—Ä—Ç–∞–ø'];
    const greeting = DialogueSystem.buildGreeting(s, ext);
    const question = DialogueSystem.buildQuestion(building.type, s);
    const demandInfo = `–ü–æ–ø–∏—Ç –Ω–∞ —Ä–∏–Ω–∫—É: ${Math.round(EconomySystem.getDemand(building.type))}%`;
    const extBonus = StatsSystem.getInterviewBonus(ext, building.type);
    const extHint = extBonus > 0 ? ` [+${extBonus} –≤—ñ–¥ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–≤–∏—á–æ–∫]` : extBonus < 0 ? ` [${extBonus} —Å—Ç—Ä–µ—Å/—Ç—Ä–∏–≤–æ–≥–∞]` : '';

    this.dialogue = {
      visible: true,
      speaker: `${building.name} (${typeNames[building.type]})`,
      text: `${greeting}\n\n${question}\n\n[${demandInfo}${extHint}]`,
      options: [],
      callback: () => {
        // Show evaluation result
        const result = DialogueSystem.evaluateInterview(building.type, s, this.player.bribeBonus, ext);
        this.player.bribeBonus = false;
        if (ext) ext.jobOfferReceived++;
        this.interviewsDone++;
        building.interviewDone = true;

        if (result.passed) {
          building.jobOffered = true;
          const endingMap = { 0: 'it', 1: 'factory', 2: 'startup' };
          this.dialogue = {
            visible: true,
            speaker: building.name,
            text: `üéâ ${result.text}\n\n–û—Ü—ñ–Ω–∫–∞: ${result.score}/100\n–ü—Ä–∏–≤—ñ—Ç–∞—î–º–æ!`,
            options: [],
            callback: () => {
              this.dialogue.visible = false;
              this.state = 'playing';
              this._triggerEnding(endingMap[building.type] || 'it');
            },
          };
        } else {
          const reqText = result.requirements.length
            ? `–í–∏–º–æ–≥–∏ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω—ñ: ${result.requirements.join(', ')}.`
            : '–ó–∞–≥–∞–ª—å–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ–π.';
          this.dialogue = {
            visible: true,
            speaker: building.name,
            text: `‚ùå ${result.text}\n\n${reqText}\n–û—Ü—ñ–Ω–∫–∞: ${result.score}/100\n–ü—Ä–æ–∫–∞—á–∞–π—Ç–µ –Ω–∞–≤–∏—á–∫–∏ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É!`,
            options: [],
            callback: () => {
              this.dialogue.visible = false;
              this.state = 'playing';
            },
          };
        }
        this.state = 'dialogue';
      },
    };
    this.state = 'dialogue';
  }

  _talkToNPC(npc) {
    npc.talked = true;
    if (npc.type === 0) {
      this.veteransMet++;
      this._notify(`ü§ù –ó—É—Å—Ç—Ä—ñ–ª–∏ –≤–µ—Ç–µ—Ä–∞–Ω–∞: ${npc.name}`, 120);
    }
    const text = DialogueSystem.buildNPCDialogue(npc.type, this.player.stats, this.veteransMet);
    const typeNames = ['–í–µ—Ç–µ—Ä–∞–Ω', 'HR-–º–µ–Ω–µ–¥–∂–µ—Ä', '–í–∏–∫–ª–∞–¥–∞—á', '–Æ—Ä–∏—Å—Ç'];
    this.dialogue = {
      visible: true,
      speaker: `${npc.name} (${typeNames[npc.type] || 'NPC'})`,
      text,
      options: [],
      callback: () => {
        // Instructor gives language bonus
        if (npc.type === 2) {
          this.player.stats.polishLang = Math.min(100, this.player.stats.polishLang + 5);
          this._notify('üë®‚Äçüè´ –£—Ä–æ–∫ –ø–æ–ª—å—Å—å–∫–æ—ó: +5 –¥–æ –∑–Ω–∞–Ω—å!', 100);
        }
        // Lawyer gives documents bonus
        if (npc.type === 3) {
          this.player.stats.documents = Math.min(100, this.player.stats.documents + 10);
          this.player.stats.stress = Math.max(0, this.player.stats.stress - 5);
          this._notify('‚öñÔ∏è –Æ—Ä–∏—Å—Ç: +10 –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤!', 100);
        }
        this.dialogue.visible = false;
        this.state = 'playing';
      },
    };
    this.state = 'dialogue';
  }

  update() {
    if (this.state !== 'playing') {
      this._updateNotification();
      return;
    }

    this.frame++;
    EconomySystem.tick(this.frame);

    // Player update
    this.player.update(this.input, this.platforms);

    // Camera follow with lag
    this.camXTarget = this.player.x - CFG.CANVAS_W * 0.35;
    this.camXTarget = Math.max(0, Math.min(CFG.WORLD_W - CFG.CANVAS_W, this.camXTarget));
    this.camX += (this.camXTarget - this.camX) * CFG.CAMERA_LAG;

    // Enemies update
    for (const e of this.enemies) e.update(this.player, this.platforms);

    // NPCs update
    for (const n of this.npcs) n.update();

    // Check interactions
    this._checkBuildingInteraction();
    this._checkCollectibles();
    this._checkEnemyCollisions();

    // Quest update
    QuestSystem.update(this.quests, this);

    // Check endings
    this._checkEnding();

    // Autosave
    if (Date.now() - this.lastSave > CFG.AUTOSAVE_INTERVAL) {
      this.lastSave = Date.now();
      this._saveGame();
    }

    // Notification update
    this._updateNotification();

    // Building proximity hints
    for (const b of this.buildings) {
      if (b.isNearDoor(this.player)) {
        // hint drawn in draw() below
      }
    }
  }

  draw() {
    const ctx = this.ctx;
    ctx.clearRect(0, 0, CFG.CANVAS_W, CFG.CANVAS_H);

    if (this.state === 'start') {
      UISystem.drawStartScreen(ctx);
      return;
    }

    if (this.state === 'ending') {
      UISystem.drawEndingScreen(ctx, this.ending);
      return;
    }

    // Draw world
    UISystem.drawWorld(ctx, this.camX);
    UISystem.drawPlatforms(ctx, this.platforms, this.camX);

    // Draw buildings
    for (const b of this.buildings) b.draw(ctx, this.camX);

    // Collectibles
    for (const c of this.collectibles) c.draw(ctx, this.camX);

    // NPCs
    for (const n of this.npcs) n.draw(ctx, this.camX);

    // Enemies
    for (const e of this.enemies) e.draw(ctx, this.camX);

    // Player
    this.player.draw(ctx, this.camX);

    // Building door hint
    for (const b of this.buildings) {
      if (b.isNearDoor(this.player)) {
        const hx = Math.round(b.doorX - this.camX);
        const hy = Math.round(b.doorY - 24);
        ctx.fillStyle = '#ffd700';
        ctx.font = 'bold 12px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('[E] —É–≤—ñ–π—Ç–∏', hx + 16, hy);
      }
    }

    // HUD
    UISystem.drawHUD(ctx, this.player, this.camX, EconomySystem, this.questsDone, this.frame);

    // UI overlays
    UISystem.drawDialogueBox(ctx, this.dialogue);
    UISystem.drawQuestLog(ctx, this.quests, this.questLogVisible, this.player ? this.player.extStats : null);
    UISystem.drawPauseMenu(ctx, this.state === 'paused');
    UISystem.drawMoralChoice(ctx, this.moralChoice);
    UISystem.drawNotification(ctx, this.notification);
  }

  start() {
    const loop = (ts) => {
      this.update();
      this.draw();
      requestAnimationFrame(loop);
    };
    requestAnimationFrame(loop);
  }
}

// ============================================================
// INIT ‚Äî Bootstrap the game when DOM is ready
// ============================================================
function initGame() {
  const canvas = document.getElementById('gameCanvas');
  if (!canvas) return;

  // Scale canvas responsively
  function resizeCanvas() {
    const container = canvas.parentElement;
    if (!container) return;
    const ratio = CFG.CANVAS_W / CFG.CANVAS_H;
    const maxW = Math.min(container.clientWidth, CFG.CANVAS_W);
    canvas.style.width  = maxW + 'px';
    canvas.style.height = Math.round(maxW / ratio) + 'px';
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  const engine = new GameEngine(canvas);
  engine.start();

  // Expose for debug
  window.__veteranGame = engine;
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initGame);
} else {
  initGame();
}

})(); // end IIFE
</script>
</body>
</html>
